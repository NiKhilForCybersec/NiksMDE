<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Offboarding Devices | MDE Ultimate Guide</title>
    <link rel="stylesheet" href="main.css">
</head>
<body>
    <header class="header">
        <div class="header-left">
            <button class="mobile-menu-btn" aria-label="Toggle menu">â˜°</button>
            <a href="index.html" class="logo">
                <div class="logo-icon">MDE</div>
                <div class="logo-text"><span>MDE</span> Ultimate Guide</div>
            </a>
        </div>
        <div class="search-container">
            <button class="search-btn">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="11" cy="11" r="8"></circle>
                    <path d="M21 21l-4.35-4.35"></path>
                </svg>
                <span>Search documentation...</span>
                <span class="search-shortcut"><kbd>âŒ˜</kbd><kbd>K</kbd></span>
            </button>
        </div>
        <div class="header-right">
            <a href="12-2-interview-questions.html" class="header-link">Interview Prep</a>
            <a href="5-3-kql-fundamentals.html" class="header-link">KQL Guide</a>
        </div>
    </header>

    <div class="sidebar-overlay"></div>
    <aside class="sidebar"></aside>

    <main class="main-content">
        <div class="content-wrapper">
            <div class="overview-box">
                <h4>ğŸ¯ What This Page Covers</h4>
                <p>Complete guide to offboarding devices from MDE. Learn proper procedures for removing devices from management across all platforms.</p>
            </div>

            <h1>Offboarding Devices</h1>

            <p>Offboarding removes devices from MDE management. This is needed when decommissioning hardware, changing tenants, or removing devices from security scope.</p>

            <h2>When to Offboard</h2>

            <div class="code-block">
                <div class="code-header">
                    <span class="code-lang">Offboarding Scenarios</span>
                    <button class="code-copy">ğŸ“‹ Copy</button>
                </div>
                <div class="code-content">
<pre><code>WHEN TO OFFBOARD DEVICES:

COMMON SCENARIOS:
â”œâ”€â”€ Device decommissioning/retirement
â”œâ”€â”€ Device reassignment to different tenant
â”œâ”€â”€ Employee offboarding (device wipe)
â”œâ”€â”€ Migration to different EDR solution
â”œâ”€â”€ Testing/lab device cleanup
â”œâ”€â”€ Duplicate device cleanup
â””â”€â”€ Compliance requirement (data removal)

WHAT HAPPENS AFTER OFFBOARDING:
â”œâ”€â”€ Device stops sending telemetry
â”œâ”€â”€ No new alerts generated
â”œâ”€â”€ Existing data retained for 180 days
â”œâ”€â”€ Device marked as "Offboarded" in portal
â”œâ”€â”€ Device can be re-onboarded if needed
â”œâ”€â”€ Defender AV continues to function locally
â””â”€â”€ EDR capabilities disabled

WHAT TO DO BEFORE OFFBOARDING:
â”œâ”€â”€ Collect investigation package (if needed)
â”œâ”€â”€ Document device information
â”œâ”€â”€ Release from isolation (if isolated)
â”œâ”€â”€ Remove any active restrictions
â”œâ”€â”€ Export relevant hunting data
â””â”€â”€ Update asset inventory</code></pre>
                </div>
            </div>

            <h2>Windows Offboarding</h2>

            <div class="code-block">
                <div class="code-header">
                    <span class="code-lang">Windows Methods</span>
                    <button class="code-copy">ğŸ“‹ Copy</button>
                </div>
                <div class="code-content">
<pre><code>WINDOWS OFFBOARDING METHODS:

LOCAL SCRIPT:
â”œâ”€â”€ Download from: Settings â†’ Endpoints â†’ Offboarding
â”œâ”€â”€ Select: Windows 10/11
â”œâ”€â”€ Download: WindowsDefenderATPOffboardingScript.cmd
â”œâ”€â”€ Run as Administrator on device
â”œâ”€â”€ Script valid for 30 days after download
â””â”€â”€ Best for: Individual devices, testing

GROUP POLICY:
â”œâ”€â”€ Download offboarding package
â”œâ”€â”€ Extract WindowsDefenderATPOffboarding.cmd
â”œâ”€â”€ Copy to NETLOGON share
â”œâ”€â”€ Create GPO: Computer Config â†’ Policies â†’ 
â”‚   Windows Settings â†’ Scripts â†’ Startup
â”œâ”€â”€ Add offboarding script
â”œâ”€â”€ Link GPO to target OU
â””â”€â”€ Best for: Bulk offboarding AD-joined devices

MICROSOFT INTUNE:
â”œâ”€â”€ Intune admin center â†’ Endpoint security
â”œâ”€â”€ Endpoint detection and response
â”œâ”€â”€ Create new EDR policy (or modify existing)
â”œâ”€â”€ Configuration type: Offboarding
â”œâ”€â”€ Upload offboarding package
â”œâ”€â”€ Assign to device group
â””â”€â”€ Best for: Cloud-managed devices

SCCM/MECM:
â”œâ”€â”€ Download offboarding package
â”œâ”€â”€ Create package with script
â”œâ”€â”€ Create task sequence or deploy as program
â”œâ”€â”€ Target collection of devices
â””â”€â”€ Best for: ConfigMgr-managed environments

SCRIPT CONTENT EXAMPLE:
# Offboarding sets registry key to 0
reg add "HKLM\SOFTWARE\Microsoft\Windows Advanced Threat Protection\Status" /v OnboardingState /t REG_DWORD /d 0 /f</code></pre>
                </div>
            </div>

            <h2>macOS and Linux Offboarding</h2>

            <div class="code-block">
                <div class="code-header">
                    <span class="code-lang">Cross-Platform Offboarding</span>
                    <button class="code-copy">ğŸ“‹ Copy</button>
                </div>
                <div class="code-content">
<pre><code>MACOS OFFBOARDING:

MANUAL METHOD:
# Download offboarding script from portal
# Settings â†’ Endpoints â†’ Offboarding â†’ macOS

# Run offboarding script
sudo python MicrosoftDefenderATPOffboardingMacOs.py

# Verify offboarding
mdatp health --field org_id
# Should show empty or "unavailable"

# Optional: Uninstall application
sudo /Library/Application\ Support/Microsoft/Defender/uninstall/uninstall

INTUNE/JAMF:
â”œâ”€â”€ Deploy offboarding script via MDM
â”œâ”€â”€ Create script policy
â”œâ”€â”€ Target device groups
â””â”€â”€ Monitor completion

LINUX OFFBOARDING:

MANUAL METHOD:
# Download offboarding script from portal
# Settings â†’ Endpoints â†’ Offboarding â†’ Linux Server

# Run offboarding script
sudo python MicrosoftDefenderATPOffboardingLinuxServer.py

# Verify offboarding
mdatp health --field org_id
# Should be empty

# Optional: Uninstall package
# RHEL/CentOS:
sudo yum remove mdatp

# Ubuntu/Debian:
sudo apt remove mdatp

# SUSE:
sudo zypper remove mdatp</code></pre>
                </div>
            </div>

            <h2>Mobile Offboarding</h2>

            <div class="code-block">
                <div class="code-header">
                    <span class="code-lang">iOS and Android</span>
                    <button class="code-copy">ğŸ“‹ Copy</button>
                </div>
                <div class="code-content">
<pre><code>MOBILE DEVICE OFFBOARDING:

iOS:
â”œâ”€â”€ Remove app assignment in Intune
â”œâ”€â”€ User uninstalls Microsoft Defender app
â”œâ”€â”€ Remove app configuration policy
â”œâ”€â”€ Device stops reporting to MDE
â””â”€â”€ VPN profile automatically removed

ANDROID:
â”œâ”€â”€ Remove app assignment in Intune
â”œâ”€â”€ App automatically removed (managed devices)
â”œâ”€â”€ Or user uninstalls from work profile
â”œâ”€â”€ Remove app configuration policy
â””â”€â”€ VPN profile removed

VIA INTUNE:
1. Apps â†’ iOS/Android apps
2. Find Microsoft Defender
3. Edit assignments
4. Remove target groups (or add exclusion)
5. Save
6. App removed on next sync

FULL DEVICE OFFBOARDING (MDM):
â”œâ”€â”€ Intune â†’ Devices â†’ All devices
â”œâ”€â”€ Select device
â”œâ”€â”€ Retire or Wipe
â”œâ”€â”€ All corporate data removed
â””â”€â”€ MDE offboarded automatically</code></pre>
                </div>
            </div>

            <h2>Verification</h2>

            <div class="code-block">
                <div class="code-header">
                    <span class="code-lang">Verify Offboarding</span>
                    <button class="code-copy">ğŸ“‹ Copy</button>
                </div>
                <div class="code-content">
<pre><code>VERIFICATION METHODS:

WINDOWS - REGISTRY:
reg query "HKLM\SOFTWARE\Microsoft\Windows Advanced Threat Protection\Status"
# OnboardingState should be 0

WINDOWS - SERVICE:
sc query sense
# Service may still run but won't report

WINDOWS - POWERSHELL:
Get-ItemProperty -Path "HKLM:\SOFTWARE\Microsoft\Windows Advanced Threat Protection\Status"
# OnboardingState = 0

MACOS/LINUX:
mdatp health
# org_id should be empty
# licensed should be false

MDE PORTAL:
â”œâ”€â”€ Devices â†’ Device inventory
â”œâ”€â”€ Find device
â”œâ”€â”€ Status shows: Offboarded
â”œâ”€â”€ Last seen timestamp stops updating
â””â”€â”€ Historical data still visible

ADVANCED HUNTING:
DeviceInfo
| where DeviceName == "DEVICENAME"
| summarize LastSeen = max(Timestamp)
# No new records after offboarding

COMMON ISSUES:
â”œâ”€â”€ Device still shows Active: Wait 24 hours
â”œâ”€â”€ Offboarding failed: Check admin rights
â”œâ”€â”€ Script expired: Download fresh package
â””â”€â”€ Re-onboarding: Wait 24h, then re-onboard</code></pre>
                </div>
            </div>

            <h2>Data Retention</h2>

            <div class="code-block">
                <div class="code-header">
                    <span class="code-lang">Post-Offboarding Data</span>
                    <button class="code-copy">ğŸ“‹ Copy</button>
                </div>
                <div class="code-content">
<pre><code>DATA RETENTION AFTER OFFBOARDING:

RETENTION PERIOD:
â”œâ”€â”€ Device data retained for 180 days
â”œâ”€â”€ Alerts and incidents preserved
â”œâ”€â”€ Timeline data accessible
â”œâ”€â”€ Advanced hunting queries still work
â””â”€â”€ After 180 days: Data automatically purged

WHAT'S RETAINED:
â”œâ”€â”€ Historical alerts
â”œâ”€â”€ Investigation data
â”œâ”€â”€ Timeline events
â”œâ”€â”€ File analysis results
â”œâ”€â”€ Network connection logs
â””â”€â”€ User activity associated with device

WHAT STOPS:
â”œâ”€â”€ New telemetry collection
â”œâ”€â”€ Real-time protection reporting
â”œâ”€â”€ New alert generation
â”œâ”€â”€ Vulnerability assessment updates
â””â”€â”€ Software inventory updates

RE-ONBOARDING:
â”œâ”€â”€ Device can be re-onboarded anytime
â”œâ”€â”€ Wait 24 hours after offboarding
â”œâ”€â”€ Run onboarding script/package
â”œâ”€â”€ New device record created
â”œâ”€â”€ Historical data NOT linked to new record
â””â”€â”€ Treated as new device</code></pre>
                </div>
            </div>

            <div class="callout tip">
                <div class="callout-icon">ğŸ’¡</div>
                <div class="callout-content">
                    <h5>Best Practices</h5>
                    <ul>
                        <li><strong>Collect evidence first</strong>: Get investigation package before offboarding</li>
                        <li><strong>Use fresh scripts</strong>: Offboarding packages expire after 30 days</li>
                        <li><strong>Wait 24 hours</strong>: Before re-onboarding a device</li>
                        <li><strong>Document reason</strong>: Track why devices are offboarded</li>
                        <li><strong>Clean up duplicates</strong>: Offboard duplicate/stale device records</li>
                    </ul>
                </div>
            </div>

            <div class="interview-tips">
                <h3>ğŸ’¡ Key Interview Points</h3>
                <ul>
                    <li><strong>Data retention</strong>: 180 days after offboarding</li>
                    <li><strong>Methods</strong>: Script, GPO, Intune, SCCM</li>
                    <li><strong>Verification</strong>: OnboardingState = 0 in registry</li>
                    <li><strong>Re-onboarding</strong>: Wait 24 hours, then run onboarding</li>
                    <li><strong>Script expiry</strong>: Offboarding packages valid 30 days</li>
                </ul>
            </div>

            <nav class="page-nav">
                <a href="1-7-onboarding-mobile.html" class="page-nav-link prev">
                    <span class="page-nav-label">â† Previous</span>
                    <span class="page-nav-title">Onboarding Mobile</span>
                </a>
                <a href="2-1-security-portal-overview.html" class="page-nav-link next">
                    <span class="page-nav-label">Next â†’</span>
                    <span class="page-nav-title">Security Portal</span>
                </a>
            </nav>
        </div>
    </main>

    <script src="main.js"></script>
</body>
</html>
