<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Onboarding Windows | MDE Ultimate Guide</title>
    <link rel="stylesheet" href="main.css">
</head>
<body>
    <header class="header">
        <div class="header-left">
            <button class="mobile-menu-btn" aria-label="Toggle menu">â˜°</button>
            <a href="index.html" class="logo">
                <div class="logo-icon">MDE</div>
                <div class="logo-text"><span>MDE</span> Ultimate Guide</div>
            </a>
        </div>
        <div class="search-container">
            <button class="search-btn">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="11" cy="11" r="8"></circle>
                    <path d="M21 21l-4.35-4.35"></path>
                </svg>
                <span>Search documentation...</span>
                <span class="search-shortcut"><kbd>âŒ˜</kbd><kbd>K</kbd></span>
            </button>
        </div>
        <div class="header-right">
            <a href="12-2-interview-questions.html" class="header-link">Interview Prep</a>
            <a href="5-3-kql-fundamentals.html" class="header-link">KQL Guide</a>
        </div>
    </header>

    <div class="sidebar-overlay"></div>
    <aside class="sidebar"></aside>

    <main class="main-content">
        <div class="content-wrapper">
            <div class="overview-box">
                <h4>ğŸ¯ What This Page Covers</h4>
                <p>Complete guide to onboarding Windows devices to MDE. Learn deployment methods (Intune, GPO, SCCM, local script), prerequisites, verification steps, and troubleshooting common issues.</p>
            </div>

            <h1>Onboarding Windows Devices</h1>

            <p>Onboarding is the process of configuring Windows devices to send telemetry to MDE and receive protection. Multiple deployment methods are available depending on your infrastructure.</p>

            <h2>Prerequisites</h2>

            <div class="code-block">
                <div class="code-header">
                    <span class="code-lang">Onboarding Prerequisites</span>
                    <button class="code-copy">ğŸ“‹ Copy</button>
                </div>
                <div class="code-content">
<pre><code>SUPPORTED OPERATING SYSTEMS:

WINDOWS CLIENT:
â”œâ”€â”€ Windows 11 (all versions)
â”œâ”€â”€ Windows 10 (1607 and later)
â”œâ”€â”€ Windows 8.1 (with prerequisites)
â””â”€â”€ Windows 7 SP1 (with prerequisites, limited support)

WINDOWS SERVER:
â”œâ”€â”€ Windows Server 2022
â”œâ”€â”€ Windows Server 2019
â”œâ”€â”€ Windows Server 2016
â”œâ”€â”€ Windows Server 2012 R2 (with MMA agent)
â””â”€â”€ Windows Server 2008 R2 SP1 (limited, with MMA)

NETWORK REQUIREMENTS:
â”œâ”€â”€ HTTPS (443) outbound to Microsoft cloud
â”œâ”€â”€ Proxy support available
â””â”€â”€ URLs to allow:
    â”œâ”€â”€ *.securitycenter.windows.com
    â”œâ”€â”€ *.blob.core.windows.net
    â”œâ”€â”€ *.ods.opinsights.azure.com
    â””â”€â”€ See full list in documentation

LICENSING:
â”œâ”€â”€ Microsoft Defender for Endpoint P1 or P2
â”œâ”€â”€ Microsoft 365 E5/E5 Security
â”œâ”€â”€ Microsoft 365 A5 (Education)
â””â”€â”€ Standalone MDE licenses</code></pre>
                </div>
            </div>

            <h2>Deployment Methods</h2>

            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>Method</th>
                            <th>Best For</th>
                            <th>Scale</th>
                            <th>Management</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Intune</strong></td>
                            <td>Cloud-managed devices</td>
                            <td>Enterprise</td>
                            <td>Cloud</td>
                        </tr>
                        <tr>
                            <td><strong>Group Policy</strong></td>
                            <td>Domain-joined devices</td>
                            <td>Enterprise</td>
                            <td>On-premises</td>
                        </tr>
                        <tr>
                            <td><strong>SCCM/MECM</strong></td>
                            <td>Existing ConfigMgr environment</td>
                            <td>Enterprise</td>
                            <td>On-premises/Cloud</td>
                        </tr>
                        <tr>
                            <td><strong>Local Script</strong></td>
                            <td>Testing, small deployments</td>
                            <td>Small</td>
                            <td>Manual</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <h2>Method 1: Intune (Recommended)</h2>

            <div class="code-block">
                <div class="code-header">
                    <span class="code-lang">Intune Onboarding Steps</span>
                    <button class="code-copy">ğŸ“‹ Copy</button>
                </div>
                <div class="code-content">
<pre><code>INTUNE ONBOARDING:

STEP 1: Connect Intune to MDE
â”œâ”€â”€ Go to endpoint.microsoft.com
â”œâ”€â”€ Endpoint security â†’ Microsoft Defender for Endpoint
â”œâ”€â”€ Open Microsoft Defender Security Center
â””â”€â”€ Enable Intune connection

STEP 2: Enable Endpoint Security
â”œâ”€â”€ Endpoint security â†’ Setup â†’ Microsoft Defender for Endpoint
â”œâ”€â”€ Set "Connect Windows devices..." to On
â””â”€â”€ Wait for sync (can take up to 24 hours first time)

STEP 3: Create Onboarding Policy
â”œâ”€â”€ Endpoint security â†’ Endpoint detection and response
â”œâ”€â”€ Create policy
â”œâ”€â”€ Platform: Windows 10 and later
â”œâ”€â”€ Profile: Endpoint detection and response
â”œâ”€â”€ Settings:
â”‚   â”œâ”€â”€ Expedite telemetry reporting: Yes
â”‚   â”œâ”€â”€ Sample sharing: All file types
â”‚   â””â”€â”€ Microsoft Defender for Endpoint client configuration package type: Auto from connector

STEP 4: Assign Policy
â”œâ”€â”€ Select device groups
â”œâ”€â”€ All devices OR specific groups
â””â”€â”€ Save and deploy

STEP 5: Verify
â”œâ”€â”€ Devices appear in MDE portal within 20-30 min
â”œâ”€â”€ Check device inventory
â””â”€â”€ Verify sensor health</code></pre>
                </div>
            </div>

            <h2>Method 2: Group Policy</h2>

            <div class="code-block">
                <div class="code-header">
                    <span class="code-lang">Group Policy Onboarding</span>
                    <button class="code-copy">ğŸ“‹ Copy</button>
                </div>
                <div class="code-content">
<pre><code>GROUP POLICY ONBOARDING:

STEP 1: Download Onboarding Package
â”œâ”€â”€ security.microsoft.com
â”œâ”€â”€ Settings â†’ Endpoints â†’ Onboarding
â”œâ”€â”€ Select OS: Windows 10/11
â”œâ”€â”€ Deployment method: Group Policy
â””â”€â”€ Download package (ZIP file)

STEP 2: Extract Files
â”œâ”€â”€ WindowsDefenderATPOnboardingScript.cmd
â””â”€â”€ OptionalParamsPolicy folder (ADMX files)

STEP 3: Copy ADMX Files (Optional but recommended)
â”œâ”€â”€ Copy .admx to: \\domain\sysvol\domain\Policies\PolicyDefinitions
â”œâ”€â”€ Copy .adml to: \\domain\sysvol\domain\Policies\PolicyDefinitions\en-US
â””â”€â”€ Refresh Group Policy Management Console

STEP 4: Create GPO
â”œâ”€â”€ Open Group Policy Management
â”œâ”€â”€ Create new GPO: "MDE Onboarding"
â”œâ”€â”€ Link to target OU

STEP 5: Configure GPO Settings
â”œâ”€â”€ Computer Configuration â†’ Policies â†’ Administrative Templates
â”œâ”€â”€ Windows Components â†’ Windows Defender ATP
â”œâ”€â”€ Enable: Onboarding
â”‚   â””â”€â”€ Value: (paste content from .cmd file)
â”œâ”€â”€ Enable: Sample sharing (All file types)
â””â”€â”€ Enable: Expedite telemetry reporting

STEP 6: Deploy
â”œâ”€â”€ Link GPO to device OUs
â”œâ”€â”€ Run gpupdate /force on test devices
â””â”€â”€ Verify in MDE portal

GPO SCRIPT ALTERNATIVE:
â”œâ”€â”€ Create GPO with startup script
â”œâ”€â”€ Script: The WindowsDefenderATPOnboardingScript.cmd
â””â”€â”€ Runs once per device at startup</code></pre>
                </div>
            </div>

            <h2>Method 3: SCCM/MECM</h2>

            <div class="code-block">
                <div class="code-header">
                    <span class="code-lang">ConfigMgr Onboarding</span>
                    <button class="code-copy">ğŸ“‹ Copy</button>
                </div>
                <div class="code-content">
<pre><code>SCCM ONBOARDING:

STEP 1: Download Package
â”œâ”€â”€ security.microsoft.com â†’ Settings â†’ Onboarding
â”œâ”€â”€ Select: System Center Configuration Manager
â””â”€â”€ Download package

STEP 2: Import to ConfigMgr
â”œâ”€â”€ ConfigMgr Console â†’ Assets and Compliance
â”œâ”€â”€ Endpoint Protection â†’ Microsoft Defender ATP Policies
â”œâ”€â”€ Right-click â†’ Create Microsoft Defender ATP Policy
â”œâ”€â”€ Browse to onboarding file
â””â”€â”€ Complete wizard

STEP 3: Deploy Policy
â”œâ”€â”€ Right-click policy â†’ Deploy
â”œâ”€â”€ Select target collection
â”œâ”€â”€ Schedule deployment
â””â”€â”€ Monitor compliance

STEP 4: Verify
â”œâ”€â”€ Check MDE portal for devices
â”œâ”€â”€ ConfigMgr reports for deployment status
â””â”€â”€ Client logs: %ProgramData%\Microsoft\Windows Defender Advanced Threat Protection\Logs</code></pre>
                </div>
            </div>

            <h2>Method 4: Local Script</h2>

            <div class="code-block">
                <div class="code-header">
                    <span class="code-lang">Local Script Onboarding</span>
                    <button class="code-copy">ğŸ“‹ Copy</button>
                </div>
                <div class="code-content">
<pre><code>LOCAL SCRIPT ONBOARDING:

STEP 1: Download Package
â”œâ”€â”€ security.microsoft.com â†’ Settings â†’ Onboarding
â”œâ”€â”€ Select OS: Windows 10/11
â”œâ”€â”€ Deployment method: Local Script
â””â”€â”€ Download package

STEP 2: Run Script
â”œâ”€â”€ Extract ZIP file
â”œâ”€â”€ Run as Administrator:
â”‚   â””â”€â”€ WindowsDefenderATPLocalOnboardingScript.cmd
â”œâ”€â”€ Wait for completion message
â””â”€â”€ Reboot if prompted

STEP 3: Verify Onboarding
â”œâ”€â”€ Run detection test (see below)
â”œâ”€â”€ Check MDE portal in 20-30 minutes
â””â”€â”€ Verify device appears in inventory

DETECTION TEST:
Open PowerShell as admin and run:
powershell.exe -NoExit -ExecutionPolicy Bypass -WindowStyle Hidden $ErrorActionPreference= 'silentlycontinue';(New-Object System.Net.WebClient).DownloadString('https://raw.githubusercontent.com/microsoft/mdatp-test/main/scripts/detection-test.ps1')|IEX

OR simpler test:
cmd.exe /c "powershell -command ""&{Write-Host 'Test'}"" & echo %TEMP%\MpCmdRun.log"</code></pre>
                </div>
            </div>

            <h2>Verify Onboarding</h2>

            <div class="code-block">
                <div class="code-header">
                    <span class="code-lang">Verification Steps</span>
                    <button class="code-copy">ğŸ“‹ Copy</button>
                </div>
                <div class="code-content">
<pre><code>VERIFY ONBOARDING SUCCESS:

1. CHECK MDE PORTAL
   â”œâ”€â”€ security.microsoft.com â†’ Devices
   â”œâ”€â”€ Device should appear within 20-30 minutes
   â””â”€â”€ Health state should be "Active"

2. CHECK LOCAL REGISTRY
   reg query "HKLM\SOFTWARE\Microsoft\Windows Advanced Threat Protection\Status"
   â””â”€â”€ OnboardingState should be 1

3. CHECK SENSE SERVICE
   sc query sense
   â””â”€â”€ State should be RUNNING

4. CHECK EVENT LOGS
   Event Viewer â†’ Applications and Services Logs â†’ 
   Microsoft â†’ Windows â†’ SENSE â†’ Operational
   â””â”€â”€ Look for Event ID 1 (service started)

5. POWERSHELL VERIFICATION
   <span class="function">Get-Service</span> Sense
   <span class="function">Get-ItemProperty</span> <span class="string">"HKLM:\SOFTWARE\Microsoft\Windows Advanced Threat Protection\Status"</span>

6. RUN DETECTION TEST
   â””â”€â”€ Triggers test alert in portal
   â””â”€â”€ Confirms full pipeline working</code></pre>
                </div>
            </div>

            <h2>Troubleshooting Onboarding</h2>

            <div class="code-block">
                <div class="code-header">
                    <span class="code-lang">Common Issues and Solutions</span>
                    <button class="code-copy">ğŸ“‹ Copy</button>
                </div>
                <div class="code-content">
<pre><code>ISSUE: Device not appearing in portal
SOLUTIONS:
â”œâ”€â”€ Wait 20-30 minutes (normal delay)
â”œâ”€â”€ Check Sense service is running
â”œâ”€â”€ Verify network connectivity
â”œâ”€â”€ Check proxy settings
â””â”€â”€ Review event logs for errors

ISSUE: Sense service not starting
SOLUTIONS:
â”œâ”€â”€ Check Windows version compatibility
â”œâ”€â”€ Verify onboarding script ran successfully
â”œâ”€â”€ Check for third-party AV conflicts
â”œâ”€â”€ Run: sc start sense
â””â”€â”€ Check dependencies: sc qc sense

ISSUE: OnboardingState = 0
SOLUTIONS:
â”œâ”€â”€ Re-run onboarding script
â”œâ”€â”€ Check for policy conflicts
â”œâ”€â”€ Verify package downloaded correctly
â””â”€â”€ Check script ran with admin rights

ISSUE: Network connectivity errors
SOLUTIONS:
â”œâ”€â”€ Verify proxy settings configured
â”œâ”€â”€ Test URLs manually:
â”‚   â””â”€â”€ Invoke-WebRequest "https://x.cp.wd.microsoft.com/api/report"
â”œâ”€â”€ Check firewall rules
â”œâ”€â”€ Verify certificate trust
â””â”€â”€ Use MDEClientAnalyzer tool

MDE CLIENT ANALYZER:
â”œâ”€â”€ Download from: https://aka.ms/MDEClientAnalyzer
â”œâ”€â”€ Run as Administrator
â”œâ”€â”€ Review output for connectivity issues
â””â”€â”€ Follow remediation suggestions</code></pre>
                </div>
            </div>

            <h2>Offboarding</h2>

            <div class="code-block">
                <div class="code-header">
                    <span class="code-lang">Offboarding Process</span>
                    <button class="code-copy">ğŸ“‹ Copy</button>
                </div>
                <div class="code-content">
<pre><code>OFFBOARDING DEVICES:

WHEN TO OFFBOARD:
â”œâ”€â”€ Device decommissioned
â”œâ”€â”€ Moving to different tenant
â”œâ”€â”€ Testing/lab cleanup
â””â”€â”€ License changes

DOWNLOAD OFFBOARDING PACKAGE:
â”œâ”€â”€ security.microsoft.com â†’ Settings â†’ Offboarding
â”œâ”€â”€ Select deployment method
â”œâ”€â”€ Package valid for 30 days
â””â”€â”€ Generate new package if expired

RUN OFFBOARDING:
â”œâ”€â”€ Same methods as onboarding
â”œâ”€â”€ Script stops Sense service
â”œâ”€â”€ Clears onboarding data
â””â”€â”€ Device removed from portal after 7 days

IMPORTANT:
â”œâ”€â”€ Offboarding removes protection
â”œâ”€â”€ Historical data retained per policy
â”œâ”€â”€ Device can be re-onboarded
â””â”€â”€ Don't offboard during active incident</code></pre>
                </div>
            </div>

            <!-- Day-to-Day Section -->
            <div class="day-to-day">
                <h3>ğŸ”§ Security Engineer Day-to-Day Tasks</h3>
                
                <h4>Deployment Operations</h4>
                <ul>
                    <li>Deploy MDE to new devices</li>
                    <li>Verify successful onboarding</li>
                    <li>Troubleshoot onboarding failures</li>
                    <li>Monitor deployment coverage</li>
                    <li>Process offboarding requests</li>
                    <li>Maintain deployment documentation</li>
                </ul>

                <h4>Common Scenarios</h4>
                <div class="ticket-item">
                    <span class="ticket-type">"New device not showing in MDE"</span>
                    <span class="ticket-solution">â†’ Check Sense service, verify policy applied, wait 30 min, check connectivity.</span>
                </div>
                <div class="ticket-item">
                    <span class="ticket-type">"Mass deployment failing"</span>
                    <span class="ticket-solution">â†’ Check GPO/Intune policy, verify network access, run MDEClientAnalyzer on sample.</span>
                </div>
                <div class="ticket-item">
                    <span class="ticket-type">"Need to remove device from MDE"</span>
                    <span class="ticket-solution">â†’ Download offboarding package, run on device, wait 7 days for removal.</span>
                </div>
            </div>

            <!-- Interview Tips -->
            <div class="interview-tips">
                <h3>ğŸ’¡ Key Interview Points</h3>
                <ul>
                    <li><strong>Methods</strong>: Intune (cloud), GPO (domain), SCCM (ConfigMgr), Local script</li>
                    <li><strong>Intune</strong>: Preferred for cloud-managed devices, automatic from connector</li>
                    <li><strong>GPO</strong>: Uses onboarding script content in policy setting</li>
                    <li><strong>Verify</strong>: Check Sense service, registry OnboardingState=1, portal appearance</li>
                    <li><strong>Timeline</strong>: Devices appear in portal within 20-30 minutes</li>
                    <li><strong>Troubleshooting</strong>: MDEClientAnalyzer tool, event logs, connectivity tests</li>
                    <li><strong>Offboarding</strong>: Package valid 30 days, device removed after 7 days</li>
                </ul>
            </div>

            <nav class="page-nav">
                <a href="9-5-performance-tuning.html" class="page-nav-link prev">
                    <span class="page-nav-label">â† Previous</span>
                    <span class="page-nav-title">Performance Tuning</span>
                </a>
                <a href="10-2-onboarding-macos.html" class="page-nav-link next">
                    <span class="page-nav-label">Next â†’</span>
                    <span class="page-nav-title">Onboarding macOS</span>
                </a>
            </nav>
        </div>
    </main>

    <div class="search-modal">
        <div class="search-modal-content">
            <div class="search-modal-input-wrapper">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="11" cy="11" r="8"></circle>
                    <path d="M21 21l-4.35-4.35"></path>
                </svg>
                <input type="text" class="search-modal-input" placeholder="Search pages..." autofocus>
                <button class="search-modal-close">ESC</button>
            </div>
            <div class="search-results"></div>
        </div>
    </div>
    <script src="main.js"></script>
</body>
</html>
