<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Group Policy Settings | MDE Ultimate Guide</title>
    <link rel="stylesheet" href="main.css">
</head>
<body>
    <header class="header">
        <div class="header-left">
            <button class="mobile-menu-btn" aria-label="Toggle menu">â˜°</button>
            <a href="index.html" class="logo">
                <div class="logo-icon">MDE</div>
                <div class="logo-text"><span>MDE</span> Ultimate Guide</div>
            </a>
        </div>
        <div class="search-container">
            <button class="search-btn">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="11" cy="11" r="8"></circle>
                    <path d="M21 21l-4.35-4.35"></path>
                </svg>
                <span>Search documentation...</span>
                <span class="search-shortcut"><kbd>âŒ˜</kbd><kbd>K</kbd></span>
            </button>
        </div>
        <div class="header-right">
            <a href="12-2-interview-questions.html" class="header-link">Interview Prep</a>
            <a href="5-3-kql-fundamentals.html" class="header-link">KQL Guide</a>
        </div>
    </header>

    <div class="sidebar-overlay"></div>
    <aside class="sidebar"></aside>

    <main class="main-content">
        <div class="content-wrapper">
            <div class="overview-box">
                <h4>ğŸ¯ What This Page Covers</h4>
                <p>Complete guide to configuring Microsoft Defender for Endpoint using Group Policy. Learn GPO paths, recommended settings, and enterprise deployment strategies.</p>
            </div>

            <h1>Group Policy Settings</h1>

            <p>Group Policy provides centralized configuration management for MDE in Active Directory environments. While Intune is preferred for cloud-managed devices, GPO remains essential for on-premises and hybrid deployments.</p>

            <h2>GPO Structure Overview</h2>

            <div class="flow-diagram">
                <div class="diagram-title">MDE Group Policy Locations</div>
<pre>
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    GROUP POLICY STRUCTURE                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚  Computer Configuration â†’ Administrative Templates â†’                    â”‚
â”‚  Windows Components â†’                                                   â”‚
â”‚                                                                          â”‚
â”‚  â”œâ”€â”€ Microsoft Defender Antivirus                                       â”‚
â”‚  â”‚   â”œâ”€â”€ Real-time Protection                                           â”‚
â”‚  â”‚   â”œâ”€â”€ Scan                                                           â”‚
â”‚  â”‚   â”œâ”€â”€ Signature Updates                                              â”‚
â”‚  â”‚   â”œâ”€â”€ Exclusions                                                     â”‚
â”‚  â”‚   â”œâ”€â”€ Threats                                                        â”‚
â”‚  â”‚   â”œâ”€â”€ Quarantine                                                     â”‚
â”‚  â”‚   â”œâ”€â”€ Reporting                                                      â”‚
â”‚  â”‚   â”œâ”€â”€ Client Interface                                               â”‚
â”‚  â”‚   â”œâ”€â”€ MpEngine                                                       â”‚
â”‚  â”‚   â””â”€â”€ Windows Defender Exploit Guard                                 â”‚
â”‚  â”‚       â”œâ”€â”€ Attack Surface Reduction                                   â”‚
â”‚  â”‚       â”œâ”€â”€ Network Protection                                         â”‚
â”‚  â”‚       â”œâ”€â”€ Controlled Folder Access                                   â”‚
â”‚  â”‚       â””â”€â”€ Exploit Protection                                         â”‚
â”‚  â”‚                                                                       â”‚
â”‚  â”œâ”€â”€ Microsoft Defender Application Guard                               â”‚
â”‚  â”‚                                                                       â”‚
â”‚  â”œâ”€â”€ Windows Defender SmartScreen                                       â”‚
â”‚  â”‚                                                                       â”‚
â”‚  â””â”€â”€ Data Collection and Preview Builds                                 â”‚
â”‚      â””â”€â”€ Allow Telemetry (required for MDE)                            â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</pre>
            </div>

            <h2>Core Antivirus Settings</h2>

            <div class="code-block">
                <div class="code-header">
                    <span class="code-lang">GPO - Microsoft Defender Antivirus</span>
                    <button class="code-copy">ğŸ“‹ Copy</button>
                </div>
                <div class="code-content">
<pre><code>PATH: Computer Configuration â†’ Administrative Templates â†’ 
      Windows Components â†’ Microsoft Defender Antivirus

CRITICAL SETTINGS:

Turn off Microsoft Defender Antivirus
â”œâ”€â”€ Setting: Disabled (ensures AV stays on)
â””â”€â”€ WARNING: "Enabled" DISABLES antivirus protection!

Allow antimalware service to remain running always
â”œâ”€â”€ Setting: Enabled
â””â”€â”€ Prevents service from being stopped

REAL-TIME PROTECTION:
Path: ...Microsoft Defender Antivirus â†’ Real-time Protection

Turn on real-time protection
â”œâ”€â”€ Setting: Enabled
â””â”€â”€ Essential for endpoint protection

Turn on behavior monitoring
â”œâ”€â”€ Setting: Enabled
â””â”€â”€ Detects suspicious process behaviors

Scan all downloaded files and attachments
â”œâ”€â”€ Setting: Enabled
â””â”€â”€ Catches malware at download

Monitor file and program activity
â”œâ”€â”€ Setting: Enabled
â””â”€â”€ Continuous file system monitoring

Turn on process scanning when real-time protection is enabled
â”œâ”€â”€ Setting: Enabled
â””â”€â”€ Scans processes as they execute

CLOUD PROTECTION:
Path: ...Microsoft Defender Antivirus â†’ MpEngine

Cloud protection level
â”œâ”€â”€ Setting: Enabled â†’ High
â””â”€â”€ Options: Default, Moderate, High, High+, Zero tolerance

Configure extended cloud check
â”œâ”€â”€ Setting: Enabled â†’ 50 seconds
â””â”€â”€ Time to wait for cloud verdict

Join Microsoft MAPS
â”œâ”€â”€ Setting: Enabled â†’ Advanced MAPS
â””â”€â”€ Required for cloud-delivered protection

Send file samples when further analysis is required
â”œâ”€â”€ Setting: Enabled â†’ Send safe samples automatically
â””â”€â”€ Options: Always prompt, Send safe samples, Never send, Send all</code></pre>
                </div>
            </div>

            <h2>Scan Configuration</h2>

            <div class="code-block">
                <div class="code-header">
                    <span class="code-lang">GPO - Scan Settings</span>
                    <button class="code-copy">ğŸ“‹ Copy</button>
                </div>
                <div class="code-content">
<pre><code>PATH: Computer Configuration â†’ Administrative Templates â†’ 
      Windows Components â†’ Microsoft Defender Antivirus â†’ Scan

SCHEDULED SCAN:

Specify the scan type for scheduled scan
â”œâ”€â”€ Setting: Enabled â†’ Quick scan
â””â”€â”€ Options: Quick scan (1), Full scan (2)

Specify the day of week for scheduled scan
â”œâ”€â”€ Setting: Enabled â†’ Sunday (or 0 for daily)
â””â”€â”€ Options: 0=Daily, 1=Sunday, 2=Monday, etc.

Specify the time for daily quick scan
â”œâ”€â”€ Setting: Enabled â†’ 120 (2:00 AM in minutes from midnight)
â””â”€â”€ Value: Minutes after midnight (0-1380)

Check for latest definitions before running a scheduled scan
â”œâ”€â”€ Setting: Enabled
â””â”€â”€ Updates signatures before each scan

SCAN BEHAVIOR:

Scan removable drives
â”œâ”€â”€ Setting: Enabled
â””â”€â”€ Scans USB drives during full scan

Scan archive files
â”œâ”€â”€ Setting: Enabled
â””â”€â”€ Scans inside ZIP, RAR, etc.

Turn on email scanning
â”œâ”€â”€ Setting: Enabled
â””â”€â”€ Scans email files (PST, DBX, etc.)

Scan network files
â”œâ”€â”€ Setting: Enabled
â””â”€â”€ Scans files accessed over network

PERFORMANCE:

Specify the maximum percentage of CPU utilization
â”œâ”€â”€ Setting: Enabled â†’ 50
â””â”€â”€ Limits CPU during scans (default 50%)

Scan only when computer is idle
â”œâ”€â”€ Setting: Not Configured (or Disabled for servers)
â””â”€â”€ Waits for idle time before scanning</code></pre>
                </div>
            </div>

            <h2>Attack Surface Reduction</h2>

            <div class="code-block">
                <div class="code-header">
                    <span class="code-lang">GPO - ASR Rules</span>
                    <button class="code-copy">ğŸ“‹ Copy</button>
                </div>
                <div class="code-content">
<pre><code>PATH: Computer Configuration â†’ Administrative Templates â†’ 
      Windows Components â†’ Microsoft Defender Antivirus â†’ 
      Windows Defender Exploit Guard â†’ Attack Surface Reduction

Configure Attack Surface Reduction rules
â”œâ”€â”€ Setting: Enabled
â””â”€â”€ Click "Show..." to configure rules

RULE CONFIGURATION FORMAT:
Rule GUID = Value
â”œâ”€â”€ 0 = Disabled
â”œâ”€â”€ 1 = Block
â”œâ”€â”€ 2 = Audit
â””â”€â”€ 6 = Warn

RECOMMENDED RULES (Block mode = 1):

BE9BA2D9-53EA-4CDC-84E5-9B1EEEE46550 = 1
â””â”€â”€ Block executable content from email

D4F940AB-401B-4EFC-AADC-AD5F3C50688A = 1
â””â”€â”€ Block Office apps from creating child processes

3B576869-A4EC-4529-8536-B80A7769E899 = 1
â””â”€â”€ Block Office apps from creating executable content

75668C1F-73B5-4CF0-BB93-3ECF5CB7CC84 = 1
â””â”€â”€ Block Office apps from injecting code

D3E037E1-3EB8-44C8-A917-57927947596D = 1
â””â”€â”€ Block JavaScript/VBScript from launching downloads

5BEB7EFE-FD9A-4556-801D-275E5FFC04CC = 1
â””â”€â”€ Block execution of potentially obfuscated scripts

92E97FA1-2EDF-4476-BDD6-9DD0B4DDDC7B = 1
â””â”€â”€ Block Win32 API calls from Office macros

9E6C4E1F-7D60-472F-BA1A-A39EF669E4B2 = 1
â””â”€â”€ Block credential stealing from LSASS

B2B3F03D-6A65-4F7B-A9C7-1C7EF74A9BA4 = 1
â””â”€â”€ Block untrusted processes from USB

D1E49AAC-8F56-4280-B9BA-993A6D77406C = 1
â””â”€â”€ Block process creations from PSExec/WMI

ASR EXCLUSIONS:

Exclude files and paths from ASR rules
â”œâ”€â”€ Setting: Enabled
â”œâ”€â”€ Click "Show..." to add exclusions
â””â”€â”€ Format: Full path to file or folder</code></pre>
                </div>
            </div>

            <h2>Network Protection & CFA</h2>

            <div class="code-block">
                <div class="code-header">
                    <span class="code-lang">GPO - Network Protection & Controlled Folder Access</span>
                    <button class="code-copy">ğŸ“‹ Copy</button>
                </div>
                <div class="code-content">
<pre><code>NETWORK PROTECTION:
PATH: ...Windows Defender Exploit Guard â†’ Network Protection

Prevent users and apps from accessing dangerous websites
â”œâ”€â”€ Setting: Enabled â†’ Block
â””â”€â”€ Options: Disabled (0), Block (1), Audit (2)

CONTROLLED FOLDER ACCESS:
PATH: ...Windows Defender Exploit Guard â†’ Controlled Folder Access

Configure Controlled folder access
â”œâ”€â”€ Setting: Enabled â†’ Block mode
â””â”€â”€ Options: Disabled (0), Block (1), Audit (2)

Configure protected folders
â”œâ”€â”€ Setting: Enabled
â”œâ”€â”€ Click "Show..." to add folders
â””â”€â”€ Default protected: Documents, Pictures, Videos, Music, Desktop, Favorites

Configure allowed applications
â”œâ”€â”€ Setting: Enabled
â”œâ”€â”€ Click "Show..." to add apps
â””â”€â”€ Format: Full path to executable

EXAMPLE ALLOWED APPS:
C:\Program Files\Microsoft Office\root\Office16\WINWORD.EXE
C:\Program Files\Adobe\Acrobat DC\Acrobat\Acrobat.exe
C:\Program Files\Notepad++\notepad++.exe</code></pre>
                </div>
            </div>

            <h2>Exclusions</h2>

            <div class="code-block">
                <div class="code-header">
                    <span class="code-lang">GPO - Exclusion Settings</span>
                    <button class="code-copy">ğŸ“‹ Copy</button>
                </div>
                <div class="code-content">
<pre><code>PATH: Computer Configuration â†’ Administrative Templates â†’ 
      Windows Components â†’ Microsoft Defender Antivirus â†’ Exclusions

PATH EXCLUSIONS:

Path Exclusions
â”œâ”€â”€ Setting: Enabled
â”œâ”€â”€ Click "Show..."
â””â”€â”€ Add folder paths to exclude

Example entries:
â”œâ”€â”€ C:\Program Files\CustomApp\
â”œâ”€â”€ D:\Database\*.mdf
â”œâ”€â”€ E:\Backups\
â””â”€â”€ %ProgramData%\VendorApp\

EXTENSION EXCLUSIONS:

Extension Exclusions
â”œâ”€â”€ Setting: Enabled
â”œâ”€â”€ Click "Show..."
â””â”€â”€ Add file extensions (without dot)

Example entries:
â”œâ”€â”€ mdf
â”œâ”€â”€ ldf
â”œâ”€â”€ bak
â””â”€â”€ log

PROCESS EXCLUSIONS:

Process Exclusions
â”œâ”€â”€ Setting: Enabled
â”œâ”€â”€ Click "Show..."
â””â”€â”€ Add process paths

Example entries:
â”œâ”€â”€ C:\Program Files\Microsoft SQL Server\...\sqlservr.exe
â”œâ”€â”€ C:\Program Files\Backup Software\backup.exe
â””â”€â”€ vmms.exe

WARNING:
â”œâ”€â”€ Exclusions are security risks
â”œâ”€â”€ Document all exclusions
â”œâ”€â”€ Review quarterly
â”œâ”€â”€ Use minimum necessary scope
â””â”€â”€ Never exclude user-writable folders like Temp/Downloads</code></pre>
                </div>
            </div>

            <h2>Onboarding via GPO</h2>

            <div class="code-block">
                <div class="code-header">
                    <span class="code-lang">GPO - MDE Onboarding</span>
                    <button class="code-copy">ğŸ“‹ Copy</button>
                </div>
                <div class="code-content">
<pre><code>MDE ONBOARDING VIA GROUP POLICY:

STEP 1: DOWNLOAD PACKAGE
â”œâ”€â”€ Microsoft Defender portal â†’ Settings â†’ Endpoints â†’ Onboarding
â”œâ”€â”€ Select: Windows 10/11
â”œâ”€â”€ Deployment method: Group Policy
â”œâ”€â”€ Download package (ZIP file)
â””â”€â”€ Extract to network share

STEP 2: COPY FILES
â”œâ”€â”€ WindowsDefenderATPOnboardingScript.cmd
â”œâ”€â”€ Copy to: \\domain\NETLOGON\MDE\ (or accessible share)
â””â”€â”€ Ensure NTFS permissions allow read for Domain Computers

STEP 3: CREATE GPO
â”œâ”€â”€ Open Group Policy Management Console
â”œâ”€â”€ Create new GPO: "MDE Onboarding"
â”œâ”€â”€ Link to target OU (Computers)
â””â”€â”€ Configure settings below

STEP 4: CONFIGURE STARTUP SCRIPT
Path: Computer Configuration â†’ Policies â†’ 
      Windows Settings â†’ Scripts â†’ Startup

â”œâ”€â”€ Add script
â”œâ”€â”€ Script name: WindowsDefenderATPOnboardingScript.cmd
â”œâ”€â”€ Script path: \\domain\NETLOGON\MDE\
â””â”€â”€ Parameters: (leave empty)

STEP 5: CONFIGURE SAMPLE SHARING
Path: Computer Configuration â†’ Administrative Templates â†’ 
      Windows Components â†’ Data Collection and Preview Builds

Allow Telemetry
â”œâ”€â”€ Setting: Enabled â†’ Required (Basic) or above
â””â”€â”€ Minimum for MDE functionality

VERIFICATION:
â”œâ”€â”€ gpupdate /force on target device
â”œâ”€â”€ Reboot to trigger startup script
â”œâ”€â”€ Check: reg query "HKLM\SOFTWARE\Microsoft\Windows Advanced Threat Protection\Status"
â”œâ”€â”€ OnboardingState should equal 1
â””â”€â”€ Device appears in portal within 20-30 minutes</code></pre>
                </div>
            </div>

            <h2>Recommended GPO Structure</h2>

            <div class="code-block">
                <div class="code-header">
                    <span class="code-lang">Enterprise GPO Design</span>
                    <button class="code-copy">ğŸ“‹ Copy</button>
                </div>
                <div class="code-content">
<pre><code>RECOMMENDED GPO STRUCTURE:

GPO 1: MDE-Onboarding
â”œâ”€â”€ Scope: All Windows devices
â”œâ”€â”€ Purpose: Onboard to MDE
â”œâ”€â”€ Contains: Onboarding script, telemetry settings
â””â”€â”€ Priority: Apply first

GPO 2: MDE-Baseline-Workstations
â”œâ”€â”€ Scope: Workstations OU
â”œâ”€â”€ Purpose: Standard workstation protection
â”œâ”€â”€ Contains:
â”‚   â”œâ”€â”€ Real-time protection: Enabled
â”‚   â”œâ”€â”€ Cloud protection: High
â”‚   â”œâ”€â”€ ASR rules: Block mode
â”‚   â”œâ”€â”€ Network protection: Block
â”‚   â”œâ”€â”€ Controlled folder access: Block
â”‚   â””â”€â”€ Standard scan schedule
â””â”€â”€ Priority: Apply after onboarding

GPO 3: MDE-Baseline-Servers
â”œâ”€â”€ Scope: Servers OU
â”œâ”€â”€ Purpose: Server-optimized protection
â”œâ”€â”€ Contains:
â”‚   â”œâ”€â”€ Same as workstations but:
â”‚   â”œâ”€â”€ Performance tuning for servers
â”‚   â”œâ”€â”€ Server-specific exclusions
â”‚   â””â”€â”€ Different scan schedule
â””â”€â”€ Priority: Apply after onboarding

GPO 4: MDE-Exclusions-SQLServers
â”œâ”€â”€ Scope: SQL Servers OU
â”œâ”€â”€ Purpose: SQL Server exclusions
â”œâ”€â”€ Contains: SQL file/process exclusions
â””â”€â”€ Priority: Apply last (overrides)

GPO 5: MDE-Exclusions-ExchangeServers
â”œâ”€â”€ Scope: Exchange Servers OU
â”œâ”€â”€ Purpose: Exchange exclusions
â”œâ”€â”€ Contains: Exchange file/process exclusions
â””â”€â”€ Priority: Apply last

PROCESSING ORDER:
1. MDE-Onboarding (site/domain level)
2. MDE-Baseline-[Type] (OU level)
3. MDE-Exclusions-[Role] (child OU level)</code></pre>
                </div>
            </div>

            <div class="callout warning">
                <div class="callout-icon">âš ï¸</div>
                <div class="callout-content">
                    <h5>Important Notes</h5>
                    <ul>
                        <li><strong>Tamper Protection</strong>: GPO settings may be blocked if Tamper Protection is enabled via Intune</li>
                        <li><strong>Policy conflicts</strong>: Intune policies take precedence over GPO for co-managed devices</li>
                        <li><strong>Testing</strong>: Always test GPOs on pilot devices before broad deployment</li>
                        <li><strong>Documentation</strong>: Document all GPO settings for audit and troubleshooting</li>
                    </ul>
                </div>
            </div>

            <!-- Day-to-Day Section -->
            <div class="day-to-day">
                <h3>ğŸ”§ Security Engineer Day-to-Day Tasks</h3>
                
                <h4>Common GPO Tasks</h4>
                <ul>
                    <li>Deploy ASR rules to new OUs</li>
                    <li>Add exclusions for new applications</li>
                    <li>Troubleshoot GPO application issues</li>
                    <li>Audit GPO settings for compliance</li>
                    <li>Update onboarding scripts for new tenants</li>
                </ul>

                <h4>Troubleshooting Commands</h4>
                <div class="code-block">
                    <div class="code-content">
<pre><code># Check applied GPOs
gpresult /r /scope computer

# Force GPO update
gpupdate /force

# Check specific Defender settings
reg query "HKLM\SOFTWARE\Policies\Microsoft\Windows Defender" /s

# Verify MDE onboarding
reg query "HKLM\SOFTWARE\Microsoft\Windows Advanced Threat Protection\Status"</code></pre>
                    </div>
                </div>
            </div>

            <!-- Interview Tips -->
            <div class="interview-tips">
                <h3>ğŸ’¡ Key Interview Points</h3>
                <ul>
                    <li><strong>GPO path</strong>: Computer Config â†’ Admin Templates â†’ Windows Components â†’ Microsoft Defender Antivirus</li>
                    <li><strong>ASR via GPO</strong>: Configure rules using GUID = Value format (0=Disabled, 1=Block, 2=Audit)</li>
                    <li><strong>Cloud protection</strong>: MpEngine settings for cloud block level and extended timeout</li>
                    <li><strong>Onboarding</strong>: Startup script method with downloaded package from portal</li>
                    <li><strong>Conflict resolution</strong>: Intune policies take precedence over GPO</li>
                </ul>
            </div>

            <nav class="page-nav">
                <a href="10-2-deployment-rings.html" class="page-nav-link prev">
                    <span class="page-nav-label">â† Previous</span>
                    <span class="page-nav-title">Deployment Rings</span>
                </a>
                <a href="10-4-intune-policies.html" class="page-nav-link next">
                    <span class="page-nav-label">Next â†’</span>
                    <span class="page-nav-title">Intune Policies</span>
                </a>
            </nav>
        </div>
    </main>

    <div class="search-modal">
        <div class="search-modal-content">
            <div class="search-modal-input-wrapper">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="11" cy="11" r="8"></circle>
                    <path d="M21 21l-4.35-4.35"></path>
                </svg>
                <input type="text" class="search-modal-input" placeholder="Search pages..." autofocus>
                <button class="search-modal-close">ESC</button>
            </div>
            <div class="search-results"></div>
        </div>
    </div>
    <script src="main.js"></script>
</body>
</html>
