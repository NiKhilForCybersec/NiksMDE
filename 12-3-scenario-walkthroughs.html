<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scenario Walkthroughs | MDE Ultimate Guide</title>
    <link rel="stylesheet" href="main.css">
</head>
<body>
    <header class="header">
        <div class="header-left">
            <button class="mobile-menu-btn" aria-label="Toggle menu">â˜°</button>
            <a href="index.html" class="logo">
                <div class="logo-icon">MDE</div>
                <div class="logo-text"><span>MDE</span> Ultimate Guide</div>
            </a>
        </div>
        <div class="search-container">
            <button class="search-btn">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="11" cy="11" r="8"></circle>
                    <path d="M21 21l-4.35-4.35"></path>
                </svg>
                <span>Search documentation...</span>
                <span class="search-shortcut"><kbd>âŒ˜</kbd><kbd>K</kbd></span>
            </button>
        </div>
        <div class="header-right">
            <a href="12-2-interview-questions.html" class="header-link">Interview Prep</a>
            <a href="5-3-kql-fundamentals.html" class="header-link">KQL Guide</a>
        </div>
    </header>

    <div class="sidebar-overlay"></div>
    <aside class="sidebar"></aside>

    <main class="main-content">
        <div class="content-wrapper">
            <div class="overview-box">
                <h4>ğŸ¯ What This Page Covers</h4>
                <p>Detailed scenario walkthroughs for MDE investigations. Practice step-by-step responses to common security incidents - perfect for interview preparation and skill building.</p>
            </div>

            <h1>Scenario Walkthroughs</h1>

            <p>These scenarios simulate real-world security incidents. Work through each step as you would in a SOC environment - this is exactly what interviewers look for.</p>

            <h2>Scenario 1: Phishing Email with Malicious Attachment</h2>

            <div class="code-block">
                <div class="code-header">
                    <span class="code-lang">Scenario Details</span>
                    <button class="code-copy">ğŸ“‹ Copy</button>
                </div>
                <div class="code-content">
<pre><code>â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
SCENARIO: Phishing Email with Malicious Attachment
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ALERT RECEIVED:
"Suspicious file detected - Invoice.doc.exe"
Device: WKSTN-HR-042
User: <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="4f25202721613c22263b270f2c20223f2e2136612c2022">[email&#160;protected]</a>
Severity: High
Time: 2024-01-15 09:23:45

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
STEP 1: INITIAL TRIAGE (2-5 minutes)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

QUESTIONS TO ANSWER:
â”œâ”€â”€ What triggered the alert?
â”œâ”€â”€ What is the file and where did it come from?
â”œâ”€â”€ Has it executed?
â””â”€â”€ Is the device still at risk?

ACTIONS:
1. Open alert in MDE portal
2. Review alert details:
   â”œâ”€â”€ File: Invoice.doc.exe
   â”œâ”€â”€ Location: C:\Users\john.smith\Downloads\
   â”œâ”€â”€ SHA256: [hash value]
   â””â”€â”€ Detection: Trojan:Win32/Emotet
3. Check if blocked or executed
4. Note all IOCs (hash, file name, path)

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
STEP 2: CONTAINMENT DECISION (1-2 minutes)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

DECISION MATRIX:
â”œâ”€â”€ File blocked before execution â†’ Continue investigation
â”œâ”€â”€ File executed â†’ IMMEDIATE ISOLATION
â”œâ”€â”€ Signs of lateral movement â†’ FULL ISOLATION
â””â”€â”€ Uncertain â†’ Selective isolation + investigate

THIS SCENARIO: File executed (process created)
ACTION: Isolate device (Full isolation)

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
STEP 3: DEVICE INVESTIGATION (10-15 minutes)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

TIMELINE ANALYSIS:
Open device timeline, filter to incident timeframe

KEY EVENTS TO FIND:
â”œâ”€â”€ Email received (if O365 integration)
â”œâ”€â”€ File downloaded
â”œâ”€â”€ File execution
â”œâ”€â”€ Child processes spawned
â”œâ”€â”€ Network connections made
â”œâ”€â”€ Files created/modified
â””â”€â”€ Registry changes

KQL QUERY - PROCESS TREE:</code></pre>
                </div>
            </div>

            <div class="code-block">
                <div class="code-header">
                    <span class="code-lang">KQL - Investigation Queries</span>
                    <button class="code-copy">ğŸ“‹ Copy</button>
                </div>
                <div class="code-content">
<pre><code><span class="comment">// Find the malicious process and children</span>
<span class="variable">DeviceProcessEvents</span>
<span class="operator">|</span> <span class="keyword">where</span> Timestamp <span class="operator">></span> <span class="function">ago</span>(<span class="number">1</span>d)
<span class="operator">|</span> <span class="keyword">where</span> DeviceName <span class="operator">==</span> <span class="string">"WKSTN-HR-042"</span>
<span class="operator">|</span> <span class="keyword">where</span> FileName <span class="operator">=~</span> <span class="string">"Invoice.doc.exe"</span>
    <span class="operator">or</span> InitiatingProcessFileName <span class="operator">=~</span> <span class="string">"Invoice.doc.exe"</span>
<span class="operator">|</span> <span class="keyword">project</span> Timestamp, FileName, ProcessCommandLine,
         InitiatingProcessFileName

<span class="comment">// Check for network connections</span>
<span class="variable">DeviceNetworkEvents</span>
<span class="operator">|</span> <span class="keyword">where</span> Timestamp <span class="operator">></span> <span class="function">ago</span>(<span class="number">1</span>d)
<span class="operator">|</span> <span class="keyword">where</span> DeviceName <span class="operator">==</span> <span class="string">"WKSTN-HR-042"</span>
<span class="operator">|</span> <span class="keyword">where</span> InitiatingProcessFileName <span class="operator">=~</span> <span class="string">"Invoice.doc.exe"</span>
<span class="operator">|</span> <span class="keyword">project</span> Timestamp, RemoteIP, RemotePort, RemoteUrl

<span class="comment">// Check for persistence mechanisms</span>
<span class="variable">DeviceRegistryEvents</span>
<span class="operator">|</span> <span class="keyword">where</span> Timestamp <span class="operator">></span> <span class="function">ago</span>(<span class="number">1</span>d)
<span class="operator">|</span> <span class="keyword">where</span> DeviceName <span class="operator">==</span> <span class="string">"WKSTN-HR-042"</span>
<span class="operator">|</span> <span class="keyword">where</span> RegistryKey <span class="function">has_any</span> (<span class="string">"Run"</span>, <span class="string">"RunOnce"</span>)
<span class="operator">|</span> <span class="keyword">project</span> Timestamp, ActionType, RegistryKey, RegistryValueName</code></pre>
                </div>
            </div>

            <div class="code-block">
                <div class="code-header">
                    <span class="code-lang">Scenario 1 - Continued</span>
                    <button class="code-copy">ğŸ“‹ Copy</button>
                </div>
                <div class="code-content">
<pre><code>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
STEP 4: SCOPE ASSESSMENT (5-10 minutes)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

QUESTIONS:
â”œâ”€â”€ Did malware spread to other devices?
â”œâ”€â”€ Were credentials compromised?
â”œâ”€â”€ Was data exfiltrated?
â””â”€â”€ Who else received this email?

KQL - CHECK FOR SPREAD:
DeviceFileEvents
| where Timestamp > ago(1d)
| where SHA256 == "[malware hash]"
| distinct DeviceName

FINDINGS:
â”œâ”€â”€ No other devices have the file
â”œâ”€â”€ No lateral movement detected
â”œâ”€â”€ C2 connection was made to 192.0.2.100
â””â”€â”€ 5 other users received same email (check O365)

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
STEP 5: REMEDIATION (10-15 minutes)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ACTIONS:
1. Collect investigation package (for evidence)
2. Run full AV scan on isolated device
3. Block malware hash organization-wide
4. Block C2 IP address
5. Search for and delete email from other mailboxes
6. Notify affected users

PORTAL ACTIONS:
â”œâ”€â”€ Device â†’ Collect investigation package
â”œâ”€â”€ Device â†’ Run antivirus scan (Full)
â”œâ”€â”€ Indicators â†’ Add file hash â†’ Block
â”œâ”€â”€ Indicators â†’ Add IP â†’ Block
â””â”€â”€ (O365) Search and purge malicious email

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
STEP 6: RECOVERY & CLOSURE (5-10 minutes)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

POST-REMEDIATION:
1. Verify AV scan clean
2. Check no persistence remains
3. Release device from isolation
4. Reset user credentials (precautionary)
5. Monitor for 24-48 hours

DOCUMENTATION:
â”œâ”€â”€ Update incident ticket with timeline
â”œâ”€â”€ Document all IOCs found
â”œâ”€â”€ Note remediation actions taken
â”œâ”€â”€ Classify alert as True Positive
â””â”€â”€ Close incident

LESSONS LEARNED:
â”œâ”€â”€ User clicked on suspicious attachment
â”œâ”€â”€ Detection worked, blocked execution
â”œâ”€â”€ Consider: Security awareness training
â””â”€â”€ Consider: Email attachment filtering

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</code></pre>
                </div>
            </div>

            <h2>Scenario 2: Credential Theft Attempt</h2>

            <div class="code-block">
                <div class="code-header">
                    <span class="code-lang">Credential Theft Investigation</span>
                    <button class="code-copy">ğŸ“‹ Copy</button>
                </div>
                <div class="code-content">
<pre><code>â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
SCENARIO: LSASS Memory Access Detected
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ALERT RECEIVED:
"Suspicious process accessed LSASS memory"
Device: SRV-DC-01 (Domain Controller!)
Severity: Critical
Detection: Credential dumping behavior

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
IMMEDIATE ACTIONS (CRITICAL - DC COMPROMISE)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

âš ï¸ DC COMPROMISE = HIGHEST PRIORITY

1. DO NOT isolate DC (will break AD!)
2. Immediately assess:
   â”œâ”€â”€ What process accessed LSASS?
   â”œâ”€â”€ Is it legitimate (AV, backup)?
   â”œâ”€â”€ Was credential extraction successful?
   â””â”€â”€ Any signs of lateral movement?

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
INVESTIGATION
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

CHECK ALERT DETAILS:
â”œâ”€â”€ Process: procdump64.exe
â”œâ”€â”€ Command: procdump -ma lsass.exe lsass.dmp
â”œâ”€â”€ User: IT-ADMIN (Domain Admin account)
â”œâ”€â”€ Source: Remote execution via PsExec

RED FLAGS:
â”œâ”€â”€ Procdump targeting LSASS = credential dumping
â”œâ”€â”€ Domain Admin account used
â”œâ”€â”€ Remote execution indicates attacker control
â””â”€â”€ CRITICAL: Assume all credentials compromised

KQL INVESTIGATION:</code></pre>
                </div>
            </div>

            <div class="code-block">
                <div class="code-header">
                    <span class="code-lang">KQL - Credential Theft Investigation</span>
                    <button class="code-copy">ğŸ“‹ Copy</button>
                </div>
                <div class="code-content">
<pre><code><span class="comment">// Find the LSASS access and attacker activity</span>
<span class="variable">DeviceProcessEvents</span>
<span class="operator">|</span> <span class="keyword">where</span> Timestamp <span class="operator">></span> <span class="function">ago</span>(<span class="number">24</span>h)
<span class="operator">|</span> <span class="keyword">where</span> DeviceName <span class="operator">==</span> <span class="string">"SRV-DC-01"</span>
<span class="operator">|</span> <span class="keyword">where</span> AccountName <span class="operator">==</span> <span class="string">"IT-ADMIN"</span>
<span class="operator">|</span> <span class="keyword">project</span> Timestamp, FileName, ProcessCommandLine,
         InitiatingProcessFileName
<span class="operator">|</span> <span class="keyword">order by</span> Timestamp <span class="keyword">asc</span>

<span class="comment">// Check for lateral movement with stolen creds</span>
<span class="variable">DeviceLogonEvents</span>
<span class="operator">|</span> <span class="keyword">where</span> Timestamp <span class="operator">></span> <span class="function">ago</span>(<span class="number">24</span>h)
<span class="operator">|</span> <span class="keyword">where</span> AccountName <span class="function">has_any</span> (<span class="string">"IT-ADMIN"</span>, <span class="string">"Administrator"</span>)
<span class="operator">|</span> <span class="keyword">where</span> LogonType <span class="operator">==</span> <span class="string">"Network"</span>
<span class="operator">|</span> <span class="keyword">summarize</span> Logons = <span class="function">count</span>() <span class="keyword">by</span> DeviceName, RemoteIP
<span class="operator">|</span> <span class="keyword">order by</span> Logons <span class="keyword">desc</span>

<span class="comment">// Find initial compromise (how did attacker get DA?)</span>
<span class="variable">DeviceProcessEvents</span>
<span class="operator">|</span> <span class="keyword">where</span> Timestamp <span class="operator">></span> <span class="function">ago</span>(<span class="number">7</span>d)
<span class="operator">|</span> <span class="keyword">where</span> InitiatingProcessFileName <span class="operator">=~</span> <span class="string">"psexec.exe"</span>
<span class="operator">|</span> <span class="keyword">project</span> Timestamp, DeviceName, ProcessCommandLine, AccountName</code></pre>
                </div>
            </div>

            <div class="code-block">
                <div class="code-header">
                    <span class="code-lang">Scenario 2 - Response</span>
                    <button class="code-copy">ğŸ“‹ Copy</button>
                </div>
                <div class="code-content">
<pre><code>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
RESPONSE ACTIONS
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

IMMEDIATE:
1. Disable compromised IT-ADMIN account
2. Reset KRBTGT password (twice, 10+ hours apart)
3. Reset all Domain Admin passwords
4. Identify and isolate attacker's source device
5. Engage incident response team

INVESTIGATION CONTINUATION:
â”œâ”€â”€ Find initial access point
â”œâ”€â”€ Map all compromised accounts
â”œâ”€â”€ Identify all accessed systems
â”œâ”€â”€ Check for persistence (scheduled tasks, etc.)
â””â”€â”€ Look for data exfiltration

POST-INCIDENT:
â”œâ”€â”€ Full credential reset for privileged accounts
â”œâ”€â”€ Review PAM/PIM implementation
â”œâ”€â”€ Implement LSASS protection (Credential Guard)
â”œâ”€â”€ Add LSASS access monitoring
â””â”€â”€ Security awareness for IT staff

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</code></pre>
                </div>
            </div>

            <h2>Scenario 3: Ransomware Detection</h2>

            <div class="code-block">
                <div class="code-header">
                    <span class="code-lang">Ransomware Response</span>
                    <button class="code-copy">ğŸ“‹ Copy</button>
                </div>
                <div class="code-content">
<pre><code>â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
SCENARIO: Ransomware Activity Detected
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ALERT RECEIVED:
"Ransomware behavior detected"
Device: WKSTN-FINANCE-015
User: <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="a9c3c8c7cc87cdc6cce9cac6c4d9c8c7d087cac6c4">[email&#160;protected]</a>
Additional alerts:
â”œâ”€â”€ "Shadow copy deletion"
â”œâ”€â”€ "Suspicious file encryption activity"
â””â”€â”€ "Multiple files renamed with unusual extension"

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
IMMEDIATE RESPONSE (SECONDS MATTER!)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

âš ï¸ RANSOMWARE = IMMEDIATE FULL ISOLATION

1. ISOLATE IMMEDIATELY (Full isolation)
2. Check for spread to other devices
3. Identify encryption scope
4. Preserve evidence

DO NOT:
â”œâ”€â”€ Turn off the device (destroys memory evidence)
â”œâ”€â”€ Delete any files
â”œâ”€â”€ Run unauthorized recovery tools
â””â”€â”€ Pay ransom without proper escalation

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
SCOPE ASSESSMENT
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

KQL - CHECK FOR SPREAD:</code></pre>
                </div>
            </div>

            <div class="code-block">
                <div class="code-header">
                    <span class="code-lang">KQL - Ransomware Scope</span>
                    <button class="code-copy">ğŸ“‹ Copy</button>
                </div>
                <div class="code-content">
<pre><code><span class="comment">// Find ransomware file hash and check spread</span>
<span class="keyword">let</span> RansomwareHash = <span class="string">"[SHA256 from alert]"</span>;
<span class="variable">DeviceFileEvents</span>
<span class="operator">|</span> <span class="keyword">where</span> Timestamp <span class="operator">></span> <span class="function">ago</span>(<span class="number">24</span>h)
<span class="operator">|</span> <span class="keyword">where</span> SHA256 <span class="operator">==</span> RansomwareHash
<span class="operator">|</span> <span class="keyword">distinct</span> DeviceName

<span class="comment">// Check for mass file modifications</span>
<span class="variable">DeviceFileEvents</span>
<span class="operator">|</span> <span class="keyword">where</span> Timestamp <span class="operator">></span> <span class="function">ago</span>(<span class="number">1</span>h)
<span class="operator">|</span> <span class="keyword">where</span> ActionType <span class="operator">==</span> <span class="string">"FileModified"</span>
<span class="operator">|</span> <span class="keyword">summarize</span> ModifiedCount = <span class="function">count</span>() <span class="keyword">by</span> DeviceName, <span class="function">bin</span>(Timestamp, <span class="number">5</span>m)
<span class="operator">|</span> <span class="keyword">where</span> ModifiedCount <span class="operator">></span> <span class="number">100</span>

<span class="comment">// Check for shadow copy deletion</span>
<span class="variable">DeviceProcessEvents</span>
<span class="operator">|</span> <span class="keyword">where</span> Timestamp <span class="operator">></span> <span class="function">ago</span>(<span class="number">24</span>h)
<span class="operator">|</span> <span class="keyword">where</span> ProcessCommandLine <span class="function">has_any</span> (
    <span class="string">"vssadmin delete"</span>,
    <span class="string">"wmic shadowcopy"</span>,
    <span class="string">"bcdedit"</span>
)
<span class="operator">|</span> <span class="keyword">project</span> Timestamp, DeviceName, ProcessCommandLine</code></pre>
                </div>
            </div>

            <div class="code-block">
                <div class="code-header">
                    <span class="code-lang">Scenario 3 - Continued</span>
                    <button class="code-copy">ğŸ“‹ Copy</button>
                </div>
                <div class="code-content">
<pre><code>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
CONTAINMENT & EVIDENCE
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

CONTAINMENT:
1. Isolate affected device(s)
2. Block ransomware hash org-wide
3. Block any identified C2 infrastructure
4. Disable compromised accounts
5. Consider network segmentation

EVIDENCE COLLECTION:
1. Collect investigation package
2. Capture memory dump if possible
3. Preserve ransom notes
4. Document encrypted file extensions
5. Note ransom amount and payment instructions

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
RECOVERY CONSIDERATIONS
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

OPTIONS:
â”œâ”€â”€ Restore from backups (preferred)
â”œâ”€â”€ Decryption tool available? (check NoMoreRansom.org)
â”œâ”€â”€ Pay ransom (last resort, legal/ethical concerns)
â””â”€â”€ Rebuild from scratch

BEFORE RECOVERY:
â”œâ”€â”€ Ensure threat is fully contained
â”œâ”€â”€ Identify and fix initial access vector
â”œâ”€â”€ Verify backups are not infected
â””â”€â”€ Plan phased recovery

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</code></pre>
                </div>
            </div>

            <div class="callout tip">
                <div class="callout-icon">ğŸ’¡</div>
                <div class="callout-content">
                    <h5>Interview Tips for Scenarios</h5>
                    <ul>
                        <li><strong>Talk through your process</strong>: Interviewers want to see how you think</li>
                        <li><strong>Prioritize containment</strong>: Stop the bleeding before deep investigation</li>
                        <li><strong>Ask clarifying questions</strong>: It's OK to ask for more details</li>
                        <li><strong>Document as you go</strong>: Mention that you'd be documenting actions</li>
                        <li><strong>Know your escalation points</strong>: When to involve management/IR team</li>
                    </ul>
                </div>
            </div>

            <!-- Interview Tips -->
            <div class="interview-tips">
                <h3>ğŸ’¡ Key Interview Points</h3>
                <ul>
                    <li><strong>Triage quickly</strong>: 2-5 minutes to understand the alert</li>
                    <li><strong>Containment first</strong>: Isolate before deep investigation when needed</li>
                    <li><strong>Use KQL</strong>: Demonstrate query skills during scenarios</li>
                    <li><strong>Scope the incident</strong>: Always check if it spread to other devices</li>
                    <li><strong>Document everything</strong>: Actions, findings, timeline</li>
                    <li><strong>Know when to escalate</strong>: DC compromise, ransomware = immediate escalation</li>
                </ul>
            </div>

            <nav class="page-nav">
                <a href="12-2-interview-questions.html" class="page-nav-link prev">
                    <span class="page-nav-label">â† Previous</span>
                    <span class="page-nav-title">Interview Questions</span>
                </a>
                <a href="12-4-kql-cheat-sheet.html" class="page-nav-link next">
                    <span class="page-nav-label">Next â†’</span>
                    <span class="page-nav-title">KQL Cheat Sheet</span>
                </a>
            </nav>
        </div>
    </main>

    <div class="search-modal">
        <div class="search-modal-content">
            <div class="search-modal-input-wrapper">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="11" cy="11" r="8"></circle>
                    <path d="M21 21l-4.35-4.35"></path>
                </svg>
                <input type="text" class="search-modal-input" p