<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firewall Integration | MDE Ultimate Guide</title>
    <link rel="stylesheet" href="main.css">
</head>
<body>
    <header class="header">
        <div class="header-left">
            <button class="mobile-menu-btn" aria-label="Toggle menu">â˜°</button>
            <a href="index.html" class="logo">
                <div class="logo-icon">MDE</div>
                <div class="logo-text"><span>MDE</span> Ultimate Guide</div>
            </a>
        </div>
        <div class="search-container">
            <button class="search-btn">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="11" cy="11" r="8"></circle>
                    <path d="M21 21l-4.35-4.35"></path>
                </svg>
                <span>Search documentation...</span>
                <span class="search-shortcut"><kbd>âŒ˜</kbd><kbd>K</kbd></span>
            </button>
        </div>
        <div class="header-right">
            <a href="12-2-interview-questions.html" class="header-link">Interview Prep</a>
            <a href="5-3-kql-fundamentals.html" class="header-link">KQL Guide</a>
        </div>
    </header>

    <div class="sidebar-overlay"></div>
    <aside class="sidebar"></aside>

    <main class="main-content">
        <div class="content-wrapper">
            <div class="overview-box">
                <h4>ğŸ¯ What This Page Covers</h4>
                <p>Complete guide to Windows Defender Firewall integration with MDE. Learn about firewall reporting, rule management, and network protection visibility.</p>
            </div>

            <h1>Firewall Integration</h1>

            <p>Windows Defender Firewall integrates with MDE to provide visibility into network connections, blocked traffic, and firewall rule effectiveness. This integration enhances network security monitoring.</p>

            <h2>Firewall Integration Overview</h2>

            <div class="flow-diagram">
                <div class="diagram-title">Firewall + MDE Integration</div>
<pre>
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    FIREWALL INTEGRATION                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚  WINDOWS DEFENDER FIREWALL                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                                                                   â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚   â”‚
â”‚  â”‚  â”‚   DOMAIN    â”‚  â”‚  PRIVATE    â”‚  â”‚  PUBLIC     â”‚              â”‚   â”‚
â”‚  â”‚  â”‚  PROFILE    â”‚  â”‚  PROFILE    â”‚  â”‚  PROFILE    â”‚              â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚   â”‚
â”‚  â”‚                                                                   â”‚   â”‚
â”‚  â”‚  RULES: Inbound | Outbound | Connection Security                 â”‚   â”‚
â”‚  â”‚                                                                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                               â”‚                                         â”‚
â”‚                               â–¼                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    MDE TELEMETRY                                 â”‚   â”‚
â”‚  â”‚                                                                   â”‚   â”‚
â”‚  â”‚  â€¢ Firewall status per device                                    â”‚   â”‚
â”‚  â”‚  â€¢ Blocked connection events                                     â”‚   â”‚
â”‚  â”‚  â€¢ Rule hit counts                                               â”‚   â”‚
â”‚  â”‚  â€¢ Profile changes                                               â”‚   â”‚
â”‚  â”‚  â€¢ Connection events (Network events)                            â”‚   â”‚
â”‚  â”‚                                                                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                               â”‚                                         â”‚
â”‚                               â–¼                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  MDE PORTAL: Device â†’ Network events, Firewall reports          â”‚   â”‚
â”‚  â”‚  HUNTING: DeviceNetworkEvents, DeviceFirewallEvents             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</pre>
            </div>

            <h2>Firewall Reporting</h2>

            <div class="code-block">
                <div class="code-header">
                    <span class="code-lang">Firewall Reports in MDE</span>
                    <button class="code-copy">ğŸ“‹ Copy</button>
                </div>
                <div class="code-content">
<pre><code>FIREWALL REPORTING:
Location: Reports â†’ Endpoints â†’ Firewall

AVAILABLE REPORTS:

FIREWALL STATUS:
â”œâ”€â”€ Devices with firewall on/off
â”œâ”€â”€ Status by profile (Domain/Private/Public)
â”œâ”€â”€ Devices not reporting
â””â”€â”€ Compliance percentage

BLOCKED CONNECTIONS:
â”œâ”€â”€ Inbound blocks by device
â”œâ”€â”€ Outbound blocks (if logging enabled)
â”œâ”€â”€ Top blocked applications
â”œâ”€â”€ Top blocked ports/protocols
â””â”€â”€ Trend over time

RULE EFFECTIVENESS:
â”œâ”€â”€ Rules with most hits
â”œâ”€â”€ Rules with no hits (candidates for removal)
â”œâ”€â”€ Custom rules vs default rules
â””â”€â”€ Allow vs block rule distribution

REPORT FILTERING:
â”œâ”€â”€ Time range
â”œâ”€â”€ Device groups
â”œâ”€â”€ Profile type
â”œâ”€â”€ Rule type
â””â”€â”€ Connection direction

EXPORT OPTIONS:
â”œâ”€â”€ CSV export for analysis
â”œâ”€â”€ API access for automation
â””â”€â”€ Power BI integration</code></pre>
                </div>
            </div>

            <h2>Advanced Hunting - Firewall</h2>

            <div class="code-block">
                <div class="code-header">
                    <span class="code-lang">KQL - Firewall Queries</span>
                    <button class="code-copy">ğŸ“‹ Copy</button>
                </div>
                <div class="code-content">
<pre><code><span class="comment">// Devices with firewall disabled</span>
<span class="variable">DeviceTvmSecureConfigurationAssessment</span>
<span class="operator">|</span> <span class="keyword">where</span> ConfigurationId <span class="function">has</span> <span class="string">"firewall"</span>
<span class="operator">|</span> <span class="keyword">where</span> IsCompliant <span class="operator">==</span> <span class="number">0</span>
<span class="operator">|</span> <span class="keyword">project</span> DeviceName, ConfigurationId, IsCompliant

<span class="comment">// Blocked inbound connections (if logging enabled)</span>
<span class="variable">DeviceNetworkEvents</span>
<span class="operator">|</span> <span class="keyword">where</span> Timestamp <span class="operator">></span> <span class="function">ago</span>(<span class="number">7</span>d)
<span class="operator">|</span> <span class="keyword">where</span> ActionType <span class="operator">==</span> <span class="string">"FirewallInboundConnectionBlocked"</span>
<span class="operator">|</span> <span class="keyword">summarize</span> BlockCount = <span class="function">count</span>() <span class="keyword">by</span> DeviceName, LocalPort, RemoteIP
<span class="operator">|</span> <span class="keyword">order by</span> BlockCount <span class="keyword">desc</span>

<span class="comment">// Outbound connections by process</span>
<span class="variable">DeviceNetworkEvents</span>
<span class="operator">|</span> <span class="keyword">where</span> Timestamp <span class="operator">></span> <span class="function">ago</span>(<span class="number">24</span>h)
<span class="operator">|</span> <span class="keyword">where</span> ActionType <span class="operator">==</span> <span class="string">"ConnectionSuccess"</span>
<span class="operator">|</span> <span class="keyword">summarize</span> Connections = <span class="function">count</span>() <span class="keyword">by</span> InitiatingProcessFileName, RemotePort
<span class="operator">|</span> <span class="keyword">order by</span> Connections <span class="keyword">desc</span>
<span class="operator">|</span> <span class="keyword">take</span> <span class="number">20</span>

<span class="comment">// Unusual ports used by processes</span>
<span class="variable">DeviceNetworkEvents</span>
<span class="operator">|</span> <span class="keyword">where</span> Timestamp <span class="operator">></span> <span class="function">ago</span>(<span class="number">7</span>d)
<span class="operator">|</span> <span class="keyword">where</span> ActionType <span class="operator">==</span> <span class="string">"ConnectionSuccess"</span>
<span class="operator">|</span> <span class="keyword">where</span> RemotePort <span class="function">!in</span> (<span class="number">80</span>, <span class="number">443</span>, <span class="number">53</span>, <span class="number">445</span>, <span class="number">389</span>, <span class="number">636</span>, <span class="number">88</span>)
<span class="operator">|</span> <span class="keyword">summarize</span> <span class="function">count</span>() <span class="keyword">by</span> InitiatingProcessFileName, RemotePort
<span class="operator">|</span> <span class="keyword">where</span> count_ <span class="operator">></span> <span class="number">10</span>

<span class="comment">// Listening ports</span>
<span class="variable">DeviceNetworkEvents</span>
<span class="operator">|</span> <span class="keyword">where</span> Timestamp <span class="operator">></span> <span class="function">ago</span>(<span class="number">1</span>d)
<span class="operator">|</span> <span class="keyword">where</span> ActionType <span class="operator">==</span> <span class="string">"ListeningConnectionCreated"</span>
<span class="operator">|</span> <span class="keyword">summarize</span> <span class="function">dcount</span>(DeviceName) <span class="keyword">by</span> LocalPort, InitiatingProcessFileName
<span class="operator">|</span> <span class="keyword">order by</span> LocalPort</code></pre>
                </div>
            </div>

            <h2>Firewall Rule Management</h2>

            <div class="code-block">
                <div class="code-header">
                    <span class="code-lang">Managing Firewall Rules</span>
                    <button class="code-copy">ğŸ“‹ Copy</button>
                </div>
                <div class="code-content">
<pre><code>FIREWALL RULE MANAGEMENT:

MANAGEMENT OPTIONS:
â”œâ”€â”€ Intune: Endpoint Security â†’ Firewall
â”œâ”€â”€ Group Policy: Windows Firewall with Advanced Security
â”œâ”€â”€ PowerShell: NetFirewall cmdlets
â””â”€â”€ Local: wf.msc (Windows Firewall with Advanced Security)

INTUNE FIREWALL RULES:
Location: Endpoint security â†’ Firewall â†’ Create policy

Rule configuration:
â”œâ”€â”€ Name: Descriptive rule name
â”œâ”€â”€ Direction: Inbound / Outbound
â”œâ”€â”€ Action: Allow / Block
â”œâ”€â”€ Protocol: TCP / UDP / Any
â”œâ”€â”€ Local ports: Specific or range
â”œâ”€â”€ Remote ports: Specific or range
â”œâ”€â”€ Local addresses: Specific / Any
â”œâ”€â”€ Remote addresses: Specific / Any
â”œâ”€â”€ Application: Path to executable
â”œâ”€â”€ Interface types: All / Specific
â””â”€â”€ Authorized users: All / Specific groups

POWERSHELL RULE MANAGEMENT:
# View all firewall rules
Get-NetFirewallRule | Select-Object Name, Enabled, Direction, Action

# View enabled inbound rules
Get-NetFirewallRule -Direction Inbound -Enabled True | 
    Select-Object Name, Action

# Create new inbound rule
New-NetFirewallRule -DisplayName "Allow RDP from IT" `
    -Direction Inbound -LocalPort 3389 -Protocol TCP `
    -Action Allow -RemoteAddress 10.0.1.0/24

# Disable a rule
Disable-NetFirewallRule -DisplayName "Allow RDP from IT"

# Remove a rule
Remove-NetFirewallRule -DisplayName "Allow RDP from IT"

# Export rules for backup
netsh advfirewall export "C:\backup\firewall-rules.wfw"

# Import rules
netsh advfirewall import "C:\backup\firewall-rules.wfw"</code></pre>
                </div>
            </div>

            <h2>Firewall Profiles</h2>

            <div class="code-block">
                <div class="code-header">
                    <span class="code-lang">Profile Configuration</span>
                    <button class="code-copy">ğŸ“‹ Copy</button>
                </div>
                <div class="code-content">
<pre><code>FIREWALL PROFILES:

DOMAIN PROFILE:
â”œâ”€â”€ When: Connected to domain network
â”œâ”€â”€ Trust level: High (corporate network)
â”œâ”€â”€ Typical settings:
â”‚   â”œâ”€â”€ Firewall: On
â”‚   â”œâ”€â”€ Block inbound: Allow exceptions
â”‚   â”œâ”€â”€ Allow outbound: Yes
â”‚   â””â”€â”€ Rules: More permissive
â””â”€â”€ Use: Corporate LAN connections

PRIVATE PROFILE:
â”œâ”€â”€ When: Connected to trusted private network
â”œâ”€â”€ Trust level: Medium (home/known network)
â”œâ”€â”€ Typical settings:
â”‚   â”œâ”€â”€ Firewall: On
â”‚   â”œâ”€â”€ Block inbound: Allow some
â”‚   â”œâ”€â”€ Allow outbound: Yes
â”‚   â””â”€â”€ Rules: Moderate
â””â”€â”€ Use: Home networks, VPN

PUBLIC PROFILE:
â”œâ”€â”€ When: Connected to public/unknown network
â”œâ”€â”€ Trust level: Low (untrusted network)
â”œâ”€â”€ Typical settings:
â”‚   â”œâ”€â”€ Firewall: On
â”‚   â”œâ”€â”€ Block ALL inbound: Yes
â”‚   â”œâ”€â”€ Allow outbound: Yes
â”‚   â””â”€â”€ Rules: Most restrictive
â””â”€â”€ Use: Coffee shop, airport, hotel WiFi

PROFILE DETECTION:
â”œâ”€â”€ Domain: NLA identifies domain network
â”œâ”€â”€ Private: User selects or GPO configures
â”œâ”€â”€ Public: Default for unknown networks
â””â”€â”€ Check: ncpa.cpl â†’ Network icon shows profile

POWERSHELL - CHECK PROFILES:
# View current profile settings
Get-NetFirewallProfile | Select-Object Name, Enabled, DefaultInboundAction

# Set profile settings
Set-NetFirewallProfile -Profile Public -DefaultInboundAction Block
Set-NetFirewallProfile -Profile Domain -Enabled True</code></pre>
                </div>
            </div>

            <h2>Network Protection Synergy</h2>

            <div class="code-block">
                <div class="code-header">
                    <span class="code-lang">Firewall + Network Protection</span>
                    <button class="code-copy">ğŸ“‹ Copy</button>
                </div>
                <div class="code-content">
<pre><code>NETWORK PROTECTION INTEGRATION:

FIREWALL:
â”œâ”€â”€ Controls: Port/IP level access
â”œâ”€â”€ Rules: Allow/Block by port, IP, application
â”œâ”€â”€ Direction: Inbound and outbound
â””â”€â”€ Use: Network segmentation, access control

NETWORK PROTECTION:
â”œâ”€â”€ Controls: URL/domain level access
â”œâ”€â”€ Blocks: Malicious/phishing sites
â”œâ”€â”€ Inspects: Web traffic at application layer
â””â”€â”€ Use: Web threat protection

COMBINED PROTECTION:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    OUTBOUND WEB REQUEST                     â”‚
â”‚                                                             â”‚
â”‚  Application â†’ Firewall â†’ Network Protection â†’ Internet    â”‚
â”‚                   â”‚              â”‚                          â”‚
â”‚                   â”‚              â””â”€ Checks URL reputation   â”‚
â”‚                   â”‚                 Blocks malicious sites  â”‚
â”‚                   â”‚                                         â”‚
â”‚                   â””â”€ Checks port/IP rules                   â”‚
â”‚                      Blocks unauthorized ports              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ENABLE NETWORK PROTECTION:
# Enable Network Protection (Block mode)
Set-MpPreference -EnableNetworkProtection Enabled

# Audit mode (log only)
Set-MpPreference -EnableNetworkProtection AuditMode

# Check status
Get-MpPreference | Select-Object EnableNetworkProtection</code></pre>
                </div>
            </div>

            <div class="callout tip">
                <div class="callout-icon">ğŸ’¡</div>
                <div class="callout-content">
                    <h5>Best Practices</h5>
                    <ul>
                        <li><strong>Enable on all profiles</strong>: Firewall should be on for Domain, Private, and Public</li>
                        <li><strong>Block inbound on Public</strong>: Most restrictive for untrusted networks</li>
                        <li><strong>Review rule hits</strong>: Remove unused rules, verify needed rules are working</li>
                        <li><strong>Log blocked connections</strong>: Helps with troubleshooting and threat hunting</li>
                        <li><strong>Combine with Network Protection</strong>: Defense in depth for web traffic</li>
                    </ul>
                </div>
            </div>

            <!-- Interview Tips -->
            <div class="interview-tips">
                <h3>ğŸ’¡ Key Interview Points</h3>
                <ul>
                    <li><strong>Three profiles</strong>: Domain (corporate), Private (home), Public (untrusted)</li>
                    <li><strong>MDE visibility</strong>: Firewall status, blocked connections via reporting and hunting</li>
                    <li><strong>Management</strong>: Intune, GPO, PowerShell (NetFirewall cmdlets)</li>
                    <li><strong>Network Protection</strong>: Complements firewall with URL/domain blocking</li>
                    <li><strong>Public profile</strong>: Most restrictive, block all inbound</li>
                </ul>
            </div>

            <nav class="page-nav">
                <a href="3-7-device-control.html" class="page-nav-link prev">
                    <span class="page-nav-label">â† Previous</span>
                    <span class="page-nav-title">Device Control</span>
                </a>
                <a href="3-9-tamper-protection.html" class="page-nav-link next">
                    <span class="page-nav-label">Next â†’</span>
                    <span class="page-nav-title">Tamper Protection</span>
                </a>
            </nav>
        </div>
    </main>

    <div class="search-modal">
        <div class="search-modal-content">
            <div class="search-modal-input-wrapper">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="11" cy="11" r="8"></circle>
                    <path d="M21 21l-4.35-4.35"></path>
                </svg>
                <input type="text" class="search-modal-input" placeholder="Search pages..." autofocus>
                <button class="search-modal-close">ESC</button>
            </div>
            <div class="search-results"></div>
        </div>
    </div>
    <script src="main.js"></script>
</body>
</html>
