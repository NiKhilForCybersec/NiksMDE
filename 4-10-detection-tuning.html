<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detection Tuning | MDE Ultimate Guide</title>
    <link rel="stylesheet" href="main.css">
</head>
<body>
    <header class="header">
        <div class="header-left">
            <button class="mobile-menu-btn" aria-label="Toggle menu">â˜°</button>
            <a href="index.html" class="logo">
                <div class="logo-icon">MDE</div>
                <div class="logo-text"><span>MDE</span> Ultimate Guide</div>
            </a>
        </div>
        <div class="search-container">
            <button class="search-btn">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="11" cy="11" r="8"></circle>
                    <path d="M21 21l-4.35-4.35"></path>
                </svg>
                <span>Search documentation...</span>
                <span class="search-shortcut"><kbd>âŒ˜</kbd><kbd>K</kbd></span>
            </button>
        </div>
        <div class="header-right">
            <a href="12-2-interview-questions.html" class="header-link">Interview Prep</a>
            <a href="5-3-kql-fundamentals.html" class="header-link">KQL Guide</a>
        </div>
    </header>

    <div class="sidebar-overlay"></div>
    <aside class="sidebar"></aside>

    <main class="main-content">
        <div class="content-wrapper">
            <div class="overview-box">
                <h4>ğŸ¯ What This Page Covers</h4>
                <p>Complete guide to tuning MDE detections for optimal signal-to-noise ratio. Learn to reduce false positives, suppress benign alerts, and improve detection quality.</p>
            </div>

            <h1>Detection Tuning</h1>

            <p>Detection tuning is the process of reducing false positives while maintaining detection of true threats. Well-tuned detections improve SOC efficiency and reduce alert fatigue.</p>

            <h2>Tuning Workflow</h2>

            <div class="flow-diagram">
                <div class="diagram-title">Detection Tuning Process</div>
<pre>
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    DETECTION TUNING WORKFLOW                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚  â”‚   ALERT     â”‚â”€â”€â”€â–ºâ”‚  ANALYZE    â”‚â”€â”€â”€â–ºâ”‚  CLASSIFY   â”‚                 â”‚
â”‚  â”‚  RECEIVED   â”‚    â”‚  CONTEXT    â”‚    â”‚  TP or FP   â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚                                               â”‚                         â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚                    â–¼                          â–¼                  â–¼      â”‚
â”‚             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚             â”‚ TRUE        â”‚           â”‚ FALSE       â”‚    â”‚ BENIGN    â”‚ â”‚
â”‚             â”‚ POSITIVE    â”‚           â”‚ POSITIVE    â”‚    â”‚ TRUE POS  â”‚ â”‚
â”‚             â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                    â”‚                         â”‚                  â”‚       â”‚
â”‚                    â–¼                         â–¼                  â–¼       â”‚
â”‚             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚             â”‚ Investigate â”‚           â”‚ Create      â”‚    â”‚ Suppress  â”‚ â”‚
â”‚             â”‚ & Respond   â”‚           â”‚ Suppression â”‚    â”‚ for Scope â”‚ â”‚
â”‚             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚ Rule        â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                       â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                                              â”‚                          â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚                    â–¼                         â–¼                     â–¼    â”‚
â”‚             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚             â”‚ Global      â”‚           â”‚ Scoped      â”‚       â”‚ Custom â”‚ â”‚
â”‚             â”‚ Suppression â”‚           â”‚ Suppression â”‚       â”‚ IOC    â”‚ â”‚
â”‚             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚ Allow  â”‚ â”‚
â”‚                                                             â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</pre>
            </div>

            <h2>Alert Classification</h2>

            <div class="code-block">
                <div class="code-header">
                    <span class="code-lang">Alert Classifications</span>
                    <button class="code-copy">ğŸ“‹ Copy</button>
                </div>
                <div class="code-content">
<pre><code>CLASSIFICATION OPTIONS:

TRUE POSITIVE (TP):
â”œâ”€â”€ Definition: Alert correctly identified a threat
â”œâ”€â”€ Action: Investigate and remediate
â”œâ”€â”€ Determination options:
â”‚   â”œâ”€â”€ Security test - Authorized testing
â”‚   â”œâ”€â”€ Line of business application - Known software
â”‚   â”œâ”€â”€ Confirmed activity - Verified malicious
â”‚   â””â”€â”€ Other - Miscellaneous true positive
â””â”€â”€ Impact: No tuning needed, detection working

FALSE POSITIVE (FP):
â”œâ”€â”€ Definition: Alert triggered on benign activity
â”œâ”€â”€ Action: Create suppression rule
â”œâ”€â”€ Determination options:
â”‚   â”œâ”€â”€ Not malicious - Activity is legitimate
â”‚   â”œâ”€â”€ Not enough data to validate - Inconclusive
â”‚   â””â”€â”€ Other - Miscellaneous false positive
â””â”€â”€ Impact: Tuning needed to prevent recurrence

BENIGN TRUE POSITIVE:
â”œâ”€â”€ Definition: Detection is accurate but activity is authorized
â”œâ”€â”€ Examples:
â”‚   â”œâ”€â”€ Penetration testing
â”‚   â”œâ”€â”€ Security tool execution
â”‚   â”œâ”€â”€ Administrative scripts
â”‚   â””â”€â”€ Legitimate IT operations
â”œâ”€â”€ Action: Suppress for specific scope
â””â”€â”€ Impact: Targeted suppression, keep detection for others

INFORMATIONAL:
â”œâ”€â”€ Definition: Low-severity observation
â”œâ”€â”€ Action: Review, may not require response
â””â”€â”€ Impact: Consider suppression if too noisy</code></pre>
                </div>
            </div>

            <h2>Suppression Rules</h2>

            <div class="code-block">
                <div class="code-header">
                    <span class="code-lang">Creating Suppression Rules</span>
                    <button class="code-copy">ğŸ“‹ Copy</button>
                </div>
                <div class="code-content">
<pre><code>SUPPRESSION RULES:
Location: Settings â†’ Endpoints â†’ Alert suppression

CREATING FROM ALERT:
1. Open alert details
2. Click "Create suppression rule"
3. System pre-fills conditions based on alert
4. Review and adjust conditions
5. Set scope (organization or device group)
6. Add comment explaining suppression
7. Save rule

MANUAL CREATION:
1. Settings â†’ Endpoints â†’ Alert suppression
2. Click "Add suppression rule"
3. Configure conditions:
   â”œâ”€â”€ Title contains
   â”œâ”€â”€ IOC (hash, IP, URL, file path)
   â”œâ”€â”€ File name
   â”œâ”€â”€ Folder path
   â”œâ”€â”€ User name
   â”œâ”€â”€ Device name
   â””â”€â”€ Command line
4. Set scope and expiration
5. Save

SUPPRESSION CONDITIONS:

BY FILE HASH:
â”œâ”€â”€ Most specific, lowest FP risk
â”œâ”€â”€ Use for: Known legitimate files
â””â”€â”€ Example: Hash of authorized admin tool

BY FILE PATH:
â”œâ”€â”€ Moderately specific
â”œâ”€â”€ Use for: Known application directories
â”œâ”€â”€ Example: C:\Program Files\CompanyApp\*.exe
â””â”€â”€ Risk: Malware could use same path

BY FILE NAME:
â”œâ”€â”€ Less specific, higher risk
â”œâ”€â”€ Use for: Well-known benign file names
â”œâ”€â”€ Example: certutil.exe (be careful!)
â””â”€â”€ Risk: Attackers use same names

BY COMMAND LINE:
â”œâ”€â”€ Very specific
â”œâ”€â”€ Use for: Specific command patterns
â”œâ”€â”€ Example: powershell.exe -File C:\Scripts\backup.ps1
â””â”€â”€ Good for: Authorized scripts

SCOPE OPTIONS:
â”œâ”€â”€ Organization-wide: All devices
â”œâ”€â”€ Device group: Specific group only
â””â”€â”€ Single device: One device only (rare)

EXPIRATION:
â”œâ”€â”€ No expiration: Permanent (use carefully)
â”œâ”€â”€ Set date: Time-limited suppression
â””â”€â”€ Recommendation: Review expiring rules regularly</code></pre>
                </div>
            </div>

            <h2>Finding False Positives</h2>

            <div class="code-block">
                <div class="code-header">
                    <span class="code-lang">KQL - FP Analysis Queries</span>
                    <button class="code-copy">ğŸ“‹ Copy</button>
                </div>
                <div class="code-content">
<pre><code><span class="comment">// Most common alerts - potential FP candidates</span>
<span class="variable">AlertInfo</span>
<span class="operator">|</span> <span class="keyword">where</span> Timestamp <span class="operator">></span> <span class="function">ago</span>(<span class="number">30</span>d)
<span class="operator">|</span> <span class="keyword">summarize</span> Count = <span class="function">count</span>() <span class="keyword">by</span> Title
<span class="operator">|</span> <span class="keyword">order by</span> Count <span class="keyword">desc</span>
<span class="operator">|</span> <span class="keyword">take</span> <span class="number">20</span>

<span class="comment">// Alerts resolved as False Positive</span>
<span class="variable">AlertInfo</span>
<span class="operator">|</span> <span class="keyword">where</span> Timestamp <span class="operator">></span> <span class="function">ago</span>(<span class="number">30</span>d)
<span class="operator">|</span> <span class="keyword">where</span> Classification <span class="operator">==</span> <span class="string">"FalsePositive"</span>
<span class="operator">|</span> <span class="keyword">summarize</span> FPCount = <span class="function">count</span>() <span class="keyword">by</span> Title
<span class="operator">|</span> <span class="keyword">order by</span> FPCount <span class="keyword">desc</span>

<span class="comment">// Alerts with same file generating multiple alerts</span>
<span class="variable">AlertEvidence</span>
<span class="operator">|</span> <span class="keyword">where</span> Timestamp <span class="operator">></span> <span class="function">ago</span>(<span class="number">30</span>d)
<span class="operator">|</span> <span class="keyword">where</span> EntityType <span class="operator">==</span> <span class="string">"File"</span>
<span class="operator">|</span> <span class="keyword">summarize</span> AlertCount = <span class="function">dcount</span>(AlertId) <span class="keyword">by</span> FileName, SHA256
<span class="operator">|</span> <span class="keyword">where</span> AlertCount <span class="operator">></span> <span class="number">5</span>
<span class="operator">|</span> <span class="keyword">order by</span> AlertCount <span class="keyword">desc</span>

<span class="comment">// Repetitive alerts from same device</span>
<span class="variable">AlertEvidence</span>
<span class="operator">|</span> <span class="keyword">where</span> Timestamp <span class="operator">></span> <span class="function">ago</span>(<span class="number">7</span>d)
<span class="operator">|</span> <span class="keyword">where</span> EntityType <span class="operator">==</span> <span class="string">"Machine"</span>
<span class="operator">|</span> <span class="keyword">join</span> <span class="keyword">kind=inner</span> <span class="variable">AlertInfo</span> <span class="keyword">on</span> AlertId
<span class="operator">|</span> <span class="keyword">summarize</span> Count = <span class="function">count</span>() <span class="keyword">by</span> DeviceName, Title
<span class="operator">|</span> <span class="keyword">where</span> Count <span class="operator">></span> <span class="number">10</span>
<span class="operator">|</span> <span class="keyword">order by</span> Count <span class="keyword">desc</span>

<span class="comment">// FP rate by alert title</span>
<span class="variable">AlertInfo</span>
<span class="operator">|</span> <span class="keyword">where</span> Timestamp <span class="operator">></span> <span class="function">ago</span>(<span class="number">30</span>d)
<span class="operator">|</span> <span class="keyword">where</span> Classification <span class="function">in</span> (<span class="string">"TruePositive"</span>, <span class="string">"FalsePositive"</span>)
<span class="operator">|</span> <span class="keyword">summarize</span> 
    Total = <span class="function">count</span>(),
    FP = <span class="function">countif</span>(Classification <span class="operator">==</span> <span class="string">"FalsePositive"</span>)
    <span class="keyword">by</span> Title
<span class="operator">|</span> <span class="keyword">extend</span> FPRate = <span class="function">round</span>(<span class="number">100.0</span> * FP / Total, <span class="number">1</span>)
<span class="operator">|</span> <span class="keyword">where</span> Total <span class="operator">></span> <span class="number">5</span>
<span class="operator">|</span> <span class="keyword">order by</span> FPRate <span class="keyword">desc</span></code></pre>
                </div>
            </div>

            <h2>Custom Detection Tuning</h2>

            <div class="code-block">
                <div class="code-header">
                    <span class="code-lang">Tuning Custom Detections</span>
                    <button class="code-copy">ğŸ“‹ Copy</button>
                </div>
                <div class="code-content">
<pre><code>TUNING CUSTOM DETECTION RULES:

REDUCE FALSE POSITIVES:

1. ADD EXCLUSIONS TO QUERY:
   // Before (noisy)
   DeviceProcessEvents
   | where FileName == "powershell.exe"
   | where ProcessCommandLine has "-enc"
   
   // After (tuned)
   DeviceProcessEvents
   | where FileName == "powershell.exe"
   | where ProcessCommandLine has "-enc"
   | where InitiatingProcessFileName !in~ (
       "sccm.exe", "intune.exe", "scheduled_task.exe"
   )
   | where FolderPath !startswith "C:\\Program Files\\IT-Tools"

2. ADD TIME-BASED FILTERING:
   // Exclude known maintenance windows
   | where not (
       hourofday(Timestamp) between (2 .. 4)
       and dayofweek(Timestamp) == 0  // Sunday 2-4 AM
   )

3. ADD THRESHOLD:
   // Require multiple occurrences
   | summarize Count = count() by DeviceName, AccountName
   | where Count > 3

4. ADD CONTEXT CHECKS:
   // Only alert if device is not in test group
   | join kind=inner DeviceInfo on DeviceId
   | where MachineGroup != "TestDevices"

IMPROVE TRUE POSITIVE RATE:

1. NARROW SCOPE:
   // More specific command patterns
   | where ProcessCommandLine has_all (
       "-enc", "http", "invoke"
   )

2. ADD POSITIVE INDICATORS:
   // Correlate with other suspicious activity
   | join kind=inner (
       DeviceNetworkEvents
       | where RemotePort in (4444, 5555, 8080)
   ) on DeviceId

3. WEIGHT BY RISK:
   // Higher severity for high-value assets
   | extend RiskLevel = iff(MachineGroup == "Executives", "High", "Medium")</code></pre>
                </div>
            </div>

            <h2>Tuning Best Practices</h2>

            <div class="code-block">
                <div class="code-header">
                    <span class="code-lang">Best Practices</span>
                    <button class="code-copy">ğŸ“‹ Copy</button>
                </div>
                <div class="code-content">
<pre><code>TUNING BEST PRACTICES:

1. DOCUMENT EVERYTHING
   â”œâ”€â”€ Why was suppression created?
   â”œâ”€â”€ What triggered the original alert?
   â”œâ”€â”€ Who approved the suppression?
   â”œâ”€â”€ When should it be reviewed?
   â””â”€â”€ Ticket/change number

2. USE MINIMUM SCOPE
   â”œâ”€â”€ Specific hash > file name > folder
   â”œâ”€â”€ Device group > organization-wide
   â”œâ”€â”€ Temporary > permanent
   â””â”€â”€ Avoid broad suppressions

3. REGULAR REVIEW
   â”œâ”€â”€ Monthly suppression rule audit
   â”œâ”€â”€ Quarterly custom detection review
   â”œâ”€â”€ Remove obsolete suppressions
   â””â”€â”€ Check for abuse of suppressed paths

4. TRACK METRICS
   â”œâ”€â”€ FP rate per detection
   â”œâ”€â”€ Suppression rule count trend
   â”œâ”€â”€ Alert volume before/after tuning
   â””â”€â”€ Time spent on FP investigation

5. COMMUNICATE CHANGES
   â”œâ”€â”€ Notify SOC of new suppressions
   â”œâ”€â”€ Document in runbooks
   â”œâ”€â”€ Update training materials
   â””â”€â”€ Review in team meetings

6. TEST BEFORE DEPLOY
   â”œâ”€â”€ Run custom detection in audit mode
   â”œâ”€â”€ Review results before enabling
   â”œâ”€â”€ Gradual rollout to device groups
   â””â”€â”€ Monitor for unintended consequences</code></pre>
                </div>
            </div>

            <div class="callout warning">
                <div class="callout-icon">âš ï¸</div>
                <div class="callout-content">
                    <h5>Tuning Risks</h5>
                    <ul>
                        <li><strong>Over-suppression</strong>: May miss real threats</li>
                        <li><strong>Broad rules</strong>: Attackers can exploit suppressed paths</li>
                        <li><strong>Stale rules</strong>: Old suppressions may hide new threats</li>
                        <li><strong>No documentation</strong>: Team doesn't know why alert is suppressed</li>
                    </ul>
                </div>
            </div>

            <!-- Interview Tips -->
            <div class="interview-tips">
                <h3>ğŸ’¡ Key Interview Points</h3>
                <ul>
                    <li><strong>Classifications</strong>: True Positive, False Positive, Benign True Positive</li>
                    <li><strong>Suppression scope</strong>: Most specific (hash) to least specific (file name)</li>
                    <li><strong>Tuning goal</strong>: Reduce noise while maintaining detection of threats</li>
                    <li><strong>Regular review</strong>: Suppressions should be audited monthly/quarterly</li>
                    <li><strong>Documentation</strong>: Every suppression needs justification and owner</li>
                </ul>
            </div>

            <nav class="page-nav">
                <a href="4-9-threat-intelligence.html" class="page-nav-link prev">
                    <span class="page-nav-label">â† Previous</span>
                    <span class="page-nav-title">Threat Intelligence</span>
                </a>
                <a href="5-1-advanced-hunting-overview.html" class="page-nav-link next">
                    <span class="page-nav-label">Next â†’</span>
                    <span class="page-nav-title">Advanced Hunting Overview</span>
                </a>
            </nav>
        </div>
    </main>

    <div class="search-modal">
        <div class="search-modal-content">
            <div class="search-modal-input-wrapper">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="11" cy="11" r="8"></circle>
                    <path d="M21 21l-4.35-4.35"></path>
                </svg>
                <input type="text" class="search-modal-input" placeholder="Search pages..." autofocus>
                <button class="search-modal-close">ESC</button>
            </div>
            <div class="search-results"></div>
        </div>
    </div>
    <script src="main.js"></script>
</body>
</html>
