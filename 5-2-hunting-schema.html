<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hunting Schema Reference | MDE Ultimate Guide</title>
    <link rel="stylesheet" href="main.css">
</head>
<body>
    <header class="header">
        <div class="header-left">
            <button class="mobile-menu-btn" aria-label="Toggle menu">â˜°</button>
            <a href="index.html" class="logo">
                <div class="logo-icon">MDE</div>
                <div class="logo-text"><span>MDE</span> Ultimate Guide</div>
            </a>
        </div>
        <div class="search-container">
            <button class="search-btn">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="11" cy="11" r="8"></circle>
                    <path d="M21 21l-4.35-4.35"></path>
                </svg>
                <span>Search documentation...</span>
                <span class="search-shortcut"><kbd>âŒ˜</kbd><kbd>K</kbd></span>
            </button>
        </div>
        <div class="header-right">
            <a href="12-2-interview-questions.html" class="header-link">Interview Prep</a>
            <a href="5-3-kql-fundamentals.html" class="header-link">KQL Guide</a>
        </div>
    </header>

    <div class="sidebar-overlay"></div>
    <aside class="sidebar"></aside>

    <main class="main-content">
        <div class="content-wrapper">
            <div class="overview-box">
                <h4>ğŸ¯ What This Page Covers</h4>
                <p>Complete reference for Advanced Hunting schema tables. Learn what data is available for threat hunting and investigation queries.</p>
            </div>

            <h1>Advanced Hunting Schema Reference</h1>

            <p>The Advanced Hunting schema contains all the tables you can query for threat detection, investigation, and proactive hunting.</p>

            <h2>Schema Overview</h2>

            <div class="flow-diagram">
                <div class="diagram-title">Schema Table Categories</div>
<pre>
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ADVANCED HUNTING SCHEMA                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚  DEVICE TABLES              ALERT TABLES           IDENTITY TABLES      â”‚
â”‚  â”œâ”€â”€ DeviceInfo             â”œâ”€â”€ AlertInfo          â”œâ”€â”€ IdentityLogon    â”‚
â”‚  â”œâ”€â”€ DeviceProcessEvents    â”œâ”€â”€ AlertEvidence      â”‚   Events           â”‚
â”‚  â”œâ”€â”€ DeviceNetworkEvents    â””â”€â”€ DeviceAlertEvents  â”œâ”€â”€ IdentityQuery    â”‚
â”‚  â”œâ”€â”€ DeviceFileEvents                              â”‚   Events           â”‚
â”‚  â”œâ”€â”€ DeviceRegistryEvents   TVM TABLES             â””â”€â”€ IdentityDir      â”‚
â”‚  â”œâ”€â”€ DeviceLogonEvents      â”œâ”€â”€ DeviceTvmSoftware      Events           â”‚
â”‚  â”œâ”€â”€ DeviceImageLoadEvents  â”‚   Inventory                               â”‚
â”‚  â””â”€â”€ DeviceEvents           â”œâ”€â”€ DeviceTvmSoftware  EMAIL TABLES         â”‚
â”‚                             â”‚   Vulnerabilities    â”œâ”€â”€ EmailEvents      â”‚
â”‚  CLOUD APP TABLES           â””â”€â”€ DeviceTvmSecure    â”œâ”€â”€ EmailAttachment  â”‚
â”‚  â”œâ”€â”€ CloudAppEvents             ConfigAssessment   â”‚   Info             â”‚
â”‚  â””â”€â”€ AppFileEvents                                 â””â”€â”€ EmailUrlInfo     â”‚
â”‚                                                                          â”‚
â”‚  DATA RETENTION: 30 days (Advanced Hunting), 180 days (raw telemetry)  â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</pre>
            </div>

            <h2>Device Tables</h2>

            <div class="code-block">
                <div class="code-header">
                    <span class="code-lang">Device Event Tables</span>
                    <button class="code-copy">ğŸ“‹ Copy</button>
                </div>
                <div class="code-content">
<pre><code>DEVICE TABLES - CORE TELEMETRY:

DeviceInfo
â”œâ”€â”€ Device metadata and configuration
â”œâ”€â”€ Key fields: DeviceId, DeviceName, OSPlatform, OSVersion
â”œâ”€â”€ Use: Device inventory, OS analysis
â””â”€â”€ Example: DeviceInfo | summarize by OSPlatform

DeviceProcessEvents
â”œâ”€â”€ Process creation and execution
â”œâ”€â”€ Key fields: FileName, ProcessCommandLine, InitiatingProcessFileName
â”œâ”€â”€ Key fields: SHA256, AccountName, ProcessId
â”œâ”€â”€ Use: Execution analysis, process trees
â””â”€â”€ Most used table for threat hunting

DeviceNetworkEvents
â”œâ”€â”€ Network connections (inbound/outbound)
â”œâ”€â”€ Key fields: RemoteIP, RemotePort, RemoteUrl, LocalPort
â”œâ”€â”€ Key fields: InitiatingProcessFileName, ActionType
â”œâ”€â”€ Use: C2 detection, lateral movement
â””â”€â”€ ActionType: ConnectionSuccess, ConnectionFailed, ListeningConnectionCreated

DeviceFileEvents
â”œâ”€â”€ File operations (create, modify, delete)
â”œâ”€â”€ Key fields: FileName, FolderPath, SHA256, ActionType
â”œâ”€â”€ ActionType: FileCreated, FileModified, FileDeleted, FileRenamed
â”œâ”€â”€ Use: Malware drops, data staging
â””â”€â”€ Example: File writes to temp folders

DeviceRegistryEvents
â”œâ”€â”€ Registry modifications
â”œâ”€â”€ Key fields: RegistryKey, RegistryValueName, RegistryValueData
â”œâ”€â”€ ActionType: RegistryKeyCreated, RegistryValueSet, RegistryKeyDeleted
â”œâ”€â”€ Use: Persistence detection
â””â”€â”€ Focus: Run keys, Services, scheduled tasks

DeviceLogonEvents
â”œâ”€â”€ Authentication events
â”œâ”€â”€ Key fields: LogonType, AccountName, AccountDomain, RemoteIP
â”œâ”€â”€ LogonType: Interactive (2), Network (3), Service (5), RemoteInteractive (10)
â”œâ”€â”€ Use: Lateral movement, brute force
â””â”€â”€ Correlate with failed logons

DeviceImageLoadEvents
â”œâ”€â”€ DLL and driver loading
â”œâ”€â”€ Key fields: FileName, FolderPath, SHA256, InitiatingProcessFileName
â”œâ”€â”€ Use: DLL hijacking, injection detection
â””â”€â”€ High volume - filter carefully

DeviceEvents
â”œâ”€â”€ Miscellaneous security events
â”œâ”€â”€ ActionTypes: Various (ASR, exploit protection, etc.)
â”œâ”€â”€ Use: Security feature triggers
â””â”€â”€ Catch-all for events not in other tables</code></pre>
                </div>
            </div>

            <h2>Key Fields Reference</h2>

            <div class="code-block">
                <div class="code-header">
                    <span class="code-lang">Common Fields</span>
                    <button class="code-copy">ğŸ“‹ Copy</button>
                </div>
                <div class="code-content">
<pre><code>COMMON FIELDS ACROSS TABLES:

TIMESTAMP FIELDS:
â”œâ”€â”€ Timestamp: Event time (UTC)
â””â”€â”€ ReportId: Unique event identifier

DEVICE FIELDS:
â”œâ”€â”€ DeviceId: Unique device identifier
â”œâ”€â”€ DeviceName: Computer name
â””â”€â”€ MachineGroup: Device group assignment

PROCESS FIELDS:
â”œâ”€â”€ InitiatingProcessFileName: Parent process name
â”œâ”€â”€ InitiatingProcessCommandLine: Parent command line
â”œâ”€â”€ InitiatingProcessId: Parent PID
â”œâ”€â”€ InitiatingProcessSHA256: Parent file hash
â”œâ”€â”€ FileName: Target process/file name
â”œâ”€â”€ ProcessCommandLine: Process command line
â”œâ”€â”€ ProcessId: Process ID
â””â”€â”€ SHA256: File hash

ACCOUNT FIELDS:
â”œâ”€â”€ AccountName: Username
â”œâ”€â”€ AccountDomain: Domain
â”œâ”€â”€ AccountSid: Security identifier
â”œâ”€â”€ AccountUpn: User principal name
â””â”€â”€ LogonId: Logon session ID

NETWORK FIELDS:
â”œâ”€â”€ RemoteIP: Destination IP
â”œâ”€â”€ RemotePort: Destination port
â”œâ”€â”€ RemoteUrl: Full URL
â”œâ”€â”€ LocalIP: Source IP
â”œâ”€â”€ LocalPort: Source port
â””â”€â”€ Protocol: TCP, UDP, etc.</code></pre>
                </div>
            </div>

            <h2>Alert and TVM Tables</h2>

            <div class="code-block">
                <div class="code-header">
                    <span class="code-lang">Alert and Vulnerability Tables</span>
                    <button class="code-copy">ğŸ“‹ Copy</button>
                </div>
                <div class="code-content">
<pre><code>ALERT TABLES:

AlertInfo
â”œâ”€â”€ Alert metadata
â”œâ”€â”€ Key fields: AlertId, Title, Severity, Category, Status
â”œâ”€â”€ Use: Alert analysis, metrics
â””â”€â”€ Join with AlertEvidence for details

AlertEvidence
â”œâ”€â”€ Entities linked to alerts
â”œâ”€â”€ Key fields: EntityType, EvidenceRole, EvidenceDirection
â”œâ”€â”€ EntityTypes: File, Process, IP, URL, User, Device
â””â”€â”€ Use: Investigation pivot points

TVM TABLES:

DeviceTvmSoftwareInventory
â”œâ”€â”€ Installed software on devices
â”œâ”€â”€ Key fields: SoftwareName, SoftwareVersion, SoftwareVendor
â”œâ”€â”€ Use: Software inventory, version tracking
â””â”€â”€ Join with vulnerabilities table

DeviceTvmSoftwareVulnerabilities
â”œâ”€â”€ CVEs affecting installed software
â”œâ”€â”€ Key fields: CveId, VulnerabilitySeverityLevel, SoftwareName
â”œâ”€â”€ Use: Vulnerability prioritization
â””â”€â”€ Find devices with specific CVEs

DeviceTvmSecureConfigurationAssessment
â”œâ”€â”€ Security configuration status
â”œâ”€â”€ Key fields: ConfigurationId, IsCompliant, ConfigurationCategory
â”œâ”€â”€ Use: Security posture assessment
â””â”€â”€ Find misconfigured devices</code></pre>
                </div>
            </div>

            <h2>Sample Queries by Table</h2>

            <div class="code-block">
                <div class="code-header">
                    <span class="code-lang">KQL - Table Examples</span>
                    <button class="code-copy">ğŸ“‹ Copy</button>
                </div>
                <div class="code-content">
<pre><code><span class="comment">// DeviceProcessEvents - Find PowerShell execution</span>
<span class="variable">DeviceProcessEvents</span>
<span class="operator">|</span> <span class="keyword">where</span> FileName <span class="operator">=~</span> <span class="string">"powershell.exe"</span>
<span class="operator">|</span> <span class="keyword">where</span> ProcessCommandLine <span class="function">has_any</span> (<span class="string">"-enc"</span>, <span class="string">"downloadstring"</span>)
<span class="operator">|</span> <span class="keyword">project</span> Timestamp, DeviceName, ProcessCommandLine

<span class="comment">// DeviceNetworkEvents - Outbound connections</span>
<span class="variable">DeviceNetworkEvents</span>
<span class="operator">|</span> <span class="keyword">where</span> ActionType <span class="operator">==</span> <span class="string">"ConnectionSuccess"</span>
<span class="operator">|</span> <span class="keyword">summarize</span> Connections = <span class="function">count</span>() <span class="keyword">by</span> RemoteIP
<span class="operator">|</span> <span class="keyword">top</span> <span class="number">10</span> <span class="keyword">by</span> Connections

<span class="comment">// DeviceFileEvents - Files in temp folders</span>
<span class="variable">DeviceFileEvents</span>
<span class="operator">|</span> <span class="keyword">where</span> ActionType <span class="operator">==</span> <span class="string">"FileCreated"</span>
<span class="operator">|</span> <span class="keyword">where</span> FolderPath <span class="function">has</span> <span class="string">"\\Temp\\"</span>
<span class="operator">|</span> <span class="keyword">where</span> FileName <span class="function">endswith</span> <span class="string">".exe"</span>

<span class="comment">// DeviceTvmSoftwareVulnerabilities - Critical CVEs</span>
<span class="variable">DeviceTvmSoftwareVulnerabilities</span>
<span class="operator">|</span> <span class="keyword">where</span> VulnerabilitySeverityLevel <span class="operator">==</span> <span class="string">"Critical"</span>
<span class="operator">|</span> <span class="keyword">summarize</span> Devices = <span class="function">dcount</span>(DeviceId) <span class="keyword">by</span> CveId, SoftwareName
<span class="operator">|</span> <span class="keyword">order by</span> Devices <span class="keyword">desc</span></code></pre>
                </div>
            </div>

            <div class="callout tip">
                <div class="callout-icon">ğŸ’¡</div>
                <div class="callout-content">
                    <h5>Schema Tips</h5>
                    <ul>
                        <li><strong>Start with DeviceProcessEvents</strong>: Most threat hunting starts here</li>
                        <li><strong>Join tables</strong>: Correlate across tables using DeviceId and Timestamp</li>
                        <li><strong>Use schema reference</strong>: Click table name in portal to see all fields</li>
                        <li><strong>Filter early</strong>: Add time filters first for performance</li>
                    </ul>
                </div>
            </div>

            <div class="interview-tips">
                <h3>ğŸ’¡ Key Interview Points</h3>
                <ul>
                    <li><strong>Key tables</strong>: DeviceProcessEvents, DeviceNetworkEvents, DeviceFileEvents</li>
                    <li><strong>Process hunting</strong>: DeviceProcessEvents for execution analysis</li>
                    <li><strong>Network hunting</strong>: DeviceNetworkEvents for C2, lateral movement</li>
                    <li><strong>Vulnerability</strong>: DeviceTvmSoftwareVulnerabilities for CVEs</li>
                    <li><strong>Retention</strong>: 30 days in Advanced Hunting</li>
                </ul>
            </div>

            <nav class="page-nav">
                <a href="5-1-advanced-hunting-overview.html" class="page-nav-link prev">
                    <span class="page-nav-label">â† Previous</span>
                    <span class="page-nav-title">Advanced Hunting Overview</span>
                </a>
                <a href="5-3-kql-fundamentals.html" class="page-nav-link next">
                    <span class="page-nav-label">Next â†’</span>
                    <span class="page-nav-title">KQL Fundamentals</span>
                </a>
            </nav>
        </div>
    </main>

    <div class="search-modal">
        <div class="search-modal-content">
            <div class="search-modal-input-wrapper">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="11" cy="11" r="8"></circle>
                    <path d="M21 21l-4.35-4.35"></path>
                </svg>
                <input type="text" class="search-modal-input" placeholder="Search pages..." autofocus>
                <button class="search-modal-close">ESC</button>
            </div>
            <div class="search-results"></div>
        </div>
    </div>
    <script src="main.js"></script>
</body>
</html>
