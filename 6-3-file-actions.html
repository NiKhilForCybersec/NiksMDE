<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>File Response Actions | MDE Ultimate Guide</title>
    <link rel="stylesheet" href="main.css">
</head>
<body>
    <header class="header">
        <div class="header-left">
            <button class="mobile-menu-btn" aria-label="Toggle menu">â˜°</button>
            <a href="index.html" class="logo"><div class="logo-icon">MDE</div><div class="logo-text"><span>MDE</span> Ultimate Guide</div></a>
        </div>
        <div class="search-container"><button class="search-btn"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"></circle><path d="M21 21l-4.35-4.35"></path></svg><span>Search...</span></button></div>
        <div class="header-right"><a href="12-2-interview-questions.html" class="header-link">Interview Prep</a></div>
    </header>
    <div class="sidebar-overlay"></div><aside class="sidebar"></aside>
    <main class="main-content">
        <div class="content-wrapper">
            <div class="overview-box"><h4>ğŸ¯ What This Page Covers</h4><p>Complete guide to file-based response actions. Learn to quarantine files, create indicators, and perform deep analysis.</p></div>
            <h1>File Response Actions</h1>
            <p>File actions enable containment and analysis of malicious files during incident response and threat hunting.</p>
            
            <h2>Available File Actions</h2>
            <div class="code-block"><div class="code-header"><span class="code-lang">File Action Overview</span><button class="code-copy">ğŸ“‹ Copy</button></div><div class="code-content">
<pre><code>FILE RESPONSE ACTIONS:

STOP AND QUARANTINE FILE:
â”œâ”€â”€ What it does:
â”‚   â”œâ”€â”€ Terminates process if file is running
â”‚   â”œâ”€â”€ Quarantines file on the device
â”‚   â”œâ”€â”€ Prevents future execution
â”‚   â””â”€â”€ Creates backup in quarantine folder
â”œâ”€â”€ Scope: Single device
â”œâ”€â”€ Reversible: Yes (restore from quarantine)
â”œâ”€â”€ Time: Immediate (when device online)
â”œâ”€â”€ Use case: Confirmed malicious file on specific device
â””â”€â”€ Permissions: Security Operator or higher

ADD INDICATOR (BLOCK FILE):
â”œâ”€â”€ What it does:
â”‚   â”œâ”€â”€ Blocks file by hash organization-wide
â”‚   â”œâ”€â”€ Prevents execution on all devices
â”‚   â”œâ”€â”€ Can alert, block, or allow
â”‚   â””â”€â”€ Custom response actions possible
â”œâ”€â”€ Scope: All devices in organization
â”œâ”€â”€ Propagation: ~15 minutes
â”œâ”€â”€ Reversible: Yes (remove indicator)
â”œâ”€â”€ Use case: Block malware across environment
â””â”€â”€ Hash types: SHA256 (preferred), SHA1, MD5

DOWNLOAD FILE (Live Response):
â”œâ”€â”€ What it does:
â”‚   â”œâ”€â”€ Downloads copy of file from device
â”‚   â”œâ”€â”€ For offline analysis
â”‚   â””â”€â”€ Creates password-protected ZIP
â”œâ”€â”€ Command: getfile "C:\path\to\file"
â”œâ”€â”€ Password: "infected" (standard convention)
â”œâ”€â”€ Use case: Forensic analysis, sandbox submission
â””â”€â”€ Permissions: Live Response enabled

DEEP ANALYSIS:
â”œâ”€â”€ What it does:
â”‚   â”œâ”€â”€ Submits file to Microsoft cloud sandbox
â”‚   â”œâ”€â”€ Executes in isolated environment
â”‚   â”œâ”€â”€ Records all behavior
â”‚   â””â”€â”€ Returns detailed analysis report
â”œâ”€â”€ Time: Several minutes to complete
â”œâ”€â”€ Output: Behavioral report with IOCs
â”œâ”€â”€ Use case: Analyze unknown suspicious files
â””â”€â”€ Limitations: Some files may not detonate</code></pre></div></div>

            <h2>Stop and Quarantine</h2>
            <div class="code-block"><div class="code-header"><span class="code-lang">Quarantine Process</span><button class="code-copy">ğŸ“‹ Copy</button></div><div class="code-content">
<pre><code>STOP AND QUARANTINE WORKFLOW:

FROM FILE PAGE:
1. Navigate to file (via alert, timeline, or search)
2. Click "Stop and Quarantine File"
3. Add comment explaining reason
4. Confirm action
5. Monitor in Action Center

FROM ALERT:
1. Open alert details
2. Find malicious file in evidence
3. Click file â†’ Actions â†’ Stop and Quarantine
4. Confirm with comment

WHAT HAPPENS:
â”œâ”€â”€ Process terminated (if running)
â”œâ”€â”€ File moved to: C:\ProgramData\Microsoft\Windows Defender\Quarantine
â”œâ”€â”€ File encrypted in quarantine
â”œâ”€â”€ Event logged
â”œâ”€â”€ Alert updated with action
â””â”€â”€ Action visible in Action Center

RESTORE FROM QUARANTINE:
â”œâ”€â”€ Windows Security â†’ Virus & threat protection
â”œâ”€â”€ Protection history
â”œâ”€â”€ Find quarantined item
â”œâ”€â”€ Click Restore (if false positive)
â””â”€â”€ Or via PowerShell: Restore-MpPreference

POWERSHELL - VIEW QUARANTINE:
Get-MpThreatDetection | Where-Object {$_.ActionSuccess -eq $true}
Get-MpThreat | Select-Object ThreatName, IsActive, DidThreatExecute</code></pre></div></div>

            <h2>File Indicators</h2>
            <div class="code-block"><div class="code-header"><span class="code-lang">Creating File Indicators</span><button class="code-copy">ğŸ“‹ Copy</button></div><div class="code-content">
<pre><code>FILE INDICATOR CREATION:

PORTAL METHOD:
Settings â†’ Endpoints â†’ Indicators â†’ File hashes

Steps:
1. Click "+ Add indicator"
2. Enter file hash:
   â”œâ”€â”€ SHA256 (64 characters) - PREFERRED
   â”œâ”€â”€ SHA1 (40 characters)
   â””â”€â”€ MD5 (32 characters)
3. Select action:
   â”œâ”€â”€ Allow: Whitelist the file
   â”œâ”€â”€ Audit: Log only, no block
   â”œâ”€â”€ Warn: User warning, can proceed
   â””â”€â”€ Block and remediate: Full block
4. Configure response:
   â”œâ”€â”€ Generate alert: Yes/No
   â”œâ”€â”€ Alert severity: Low/Medium/High
   â””â”€â”€ Alert category: Select appropriate
5. Set metadata:
   â”œâ”€â”€ Title: Descriptive name
   â”œâ”€â”€ Description: Why blocked, ticket number
   â””â”€â”€ Expiration: Optional date
6. Choose scope:
   â”œâ”€â”€ All devices
   â””â”€â”€ Specific device groups
7. Save

API METHOD:
POST https://api.securitycenter.microsoft.com/api/indicators
{
    "indicatorValue": "A1B2C3D4E5F6...", 
    "indicatorType": "FileSha256",
    "action": "AlertAndBlock",
    "title": "Ransomware - LockBit variant",
    "description": "Blocked per INC-12345",
    "severity": "High",
    "recommendedActions": "Isolate affected device",
    "generateAlert": true
}

BEST PRACTICES:
â”œâ”€â”€ Always use SHA256 (collision-resistant)
â”œâ”€â”€ Document incident number in description
â”œâ”€â”€ Set expiration for temporary blocks
â”œâ”€â”€ Use device groups for targeted blocking
â”œâ”€â”€ Review and clean up indicators quarterly</code></pre></div></div>

            <h2>Deep Analysis</h2>
            <div class="code-block"><div class="code-header"><span class="code-lang">Deep Analysis Process</span><button class="code-copy">ğŸ“‹ Copy</button></div><div class="code-content">
<pre><code>DEEP ANALYSIS WORKFLOW:

SUBMITTING FILE:
1. Navigate to file page
2. Click "Deep analysis"
3. Add comment
4. Submit for analysis

ANALYSIS PROCESS:
â”œâ”€â”€ File uploaded to Microsoft cloud
â”œâ”€â”€ Executed in isolated sandbox
â”œâ”€â”€ Multiple OS environments tested
â”œâ”€â”€ Behavior monitored and recorded
â”œâ”€â”€ Analysis takes 5-30 minutes
â””â”€â”€ Report generated

REPORT CONTENTS:
â”œâ”€â”€ Verdict: Clean, Suspicious, Malicious
â”œâ”€â”€ Process activity:
â”‚   â”œâ”€â”€ Processes created
â”‚   â”œâ”€â”€ Command lines executed
â”‚   â””â”€â”€ Parent-child relationships
â”œâ”€â”€ File activity:
â”‚   â”œâ”€â”€ Files created/modified/deleted
â”‚   â”œâ”€â”€ Dropped files with hashes
â”‚   â””â”€â”€ File paths
â”œâ”€â”€ Registry activity:
â”‚   â”œâ”€â”€ Keys created/modified
â”‚   â””â”€â”€ Persistence mechanisms
â”œâ”€â”€ Network activity:
â”‚   â”œâ”€â”€ DNS queries
â”‚   â”œâ”€â”€ HTTP/HTTPS connections
â”‚   â”œâ”€â”€ C2 communication
â”‚   â””â”€â”€ Downloaded content
â””â”€â”€ MITRE ATT&CK mapping

LIMITATIONS:
â”œâ”€â”€ Some samples don't detonate (VM detection)
â”œâ”€â”€ Password-protected files need password
â”œâ”€â”€ Large files may timeout
â”œâ”€â”€ Packed files may not fully unpack
â””â”€â”€ Some behaviors only in specific environments</code></pre></div></div>

            <div class="callout tip"><div class="callout-icon">ğŸ’¡</div><div class="callout-content"><h5>Best Practices</h5><ul>
                <li><strong>SHA256 always</strong>: Most reliable, collision-resistant hash</li>
                <li><strong>Document everything</strong>: Include incident numbers and reasons</li>
                <li><strong>Deep analysis first</strong>: Analyze unknown files before blocking org-wide</li>
                <li><strong>15 min propagation</strong>: Wait for indicators to spread</li>
                <li><strong>Use expiration</strong>: Set dates for temporary blocks</li>
            </ul></div></div>

            <div class="interview-tips"><h3>ğŸ’¡ Key Interview Points</h3><ul>
                <li><strong>Stop & quarantine</strong>: Single device, terminates process, quarantines file</li>
                <li><strong>Indicators</strong>: SHA256 preferred, org-wide blocking, ~15 min propagation</li>
                <li><strong>Deep analysis</strong>: Cloud sandbox, behavioral report, MITRE mapping</li>
                <li><strong>Actions</strong>: Allow, Audit, Warn, Block and remediate</li>
                <li><strong>Quarantine location</strong>: C:\ProgramData\Microsoft\Windows Defender\Quarantine</li>
            </ul></div>

            <nav class="page-nav"><a href="6-2-device-actions.html" class="page-nav-link prev"><span class="page-nav-label">â† Previous</span></a><a href="6-4-automated-remediation.html" class="page-nav-link next"><span class="page-nav-label">Next â†’</span></a></nav>
        </div>
    </main>
    <script src="main.js"></script>
</body>
</html>
