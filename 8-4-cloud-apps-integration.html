<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Defender for Cloud Apps Integration | MDE Ultimate Guide</title>
    <link rel="stylesheet" href="main.css">
</head>
<body>
    <header class="header">
        <div class="header-left">
            <button class="mobile-menu-btn" aria-label="Toggle menu">â˜°</button>
            <a href="index.html" class="logo">
                <div class="logo-icon">MDE</div>
                <div class="logo-text"><span>MDE</span> Ultimate Guide</div>
            </a>
        </div>
        <div class="search-container">
            <button class="search-btn">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="11" cy="11" r="8"></circle>
                    <path d="M21 21l-4.35-4.35"></path>
                </svg>
                <span>Search documentation...</span>
                <span class="search-shortcut"><kbd>âŒ˜</kbd><kbd>K</kbd></span>
            </button>
        </div>
        <div class="header-right">
            <a href="12-2-interview-questions.html" class="header-link">Interview Prep</a>
            <a href="5-3-kql-fundamentals.html" class="header-link">KQL Guide</a>
        </div>
    </header>

    <div class="sidebar-overlay"></div>
    <aside class="sidebar"></aside>

    <main class="main-content">
        <div class="content-wrapper">
            <div class="overview-box">
                <h4>ğŸ¯ What This Page Covers</h4>
                <p>Complete guide to integrating Microsoft Defender for Endpoint with Microsoft Defender for Cloud Apps. Learn about shadow IT discovery, app governance, and unified security.</p>
            </div>

            <h1>Defender for Cloud Apps Integration</h1>

            <p>Microsoft Defender for Cloud Apps (formerly Microsoft Cloud App Security) integrates with MDE to provide visibility into cloud app usage and enable enforcement of cloud app policies directly on endpoints.</p>

            <h2>Integration Overview</h2>

            <div class="flow-diagram">
                <div class="diagram-title">MDE + Cloud Apps Integration</div>
<pre>
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               MDE + DEFENDER FOR CLOUD APPS                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚  MICROSOFT DEFENDER            DEFENDER FOR                             â”‚
â”‚  FOR ENDPOINT                  CLOUD APPS                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚                     â”‚      â”‚                     â”‚                  â”‚
â”‚  â”‚  Endpoint           â”‚â—„â”€â”€â”€â”€â–ºâ”‚  Cloud Discovery    â”‚                  â”‚
â”‚  â”‚  Telemetry          â”‚      â”‚  App Catalog        â”‚                  â”‚
â”‚  â”‚                     â”‚      â”‚  Policy Enforcement â”‚                  â”‚
â”‚  â”‚  Network Traffic    â”‚      â”‚  Risk Assessment    â”‚                  â”‚
â”‚  â”‚  Process Data       â”‚      â”‚  DLP Integration    â”‚                  â”‚
â”‚  â”‚                     â”‚      â”‚                     â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚           â”‚                            â”‚                                â”‚
â”‚           â”‚      Integration           â”‚                                â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚
â”‚                       â”‚                                                 â”‚
â”‚                       â–¼                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚                    CAPABILITIES                               â”‚      â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”‚
â”‚  â”‚ â€¢ Shadow IT Discovery (find unsanctioned apps)               â”‚      â”‚
â”‚  â”‚ â€¢ App risk assessment (risk scoring)                         â”‚      â”‚
â”‚  â”‚ â€¢ Block unsanctioned apps (via Network Protection)           â”‚      â”‚
â”‚  â”‚ â€¢ Monitor cloud app activity                                 â”‚      â”‚
â”‚  â”‚ â€¢ Enforce session policies                                   â”‚      â”‚
â”‚  â”‚ â€¢ Unified investigation across endpoint and cloud            â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</pre>
            </div>

            <h2>Enabling Integration</h2>

            <div class="code-block">
                <div class="code-header">
                    <span class="code-lang">Setup Steps</span>
                    <button class="code-copy">ğŸ“‹ Copy</button>
                </div>
                <div class="code-content">
<pre><code>STEP 1: ENABLE IN MDE
Location: Settings â†’ Endpoints â†’ Advanced features
â”œâ”€â”€ Microsoft Defender for Cloud Apps: Toggle ON
â””â”€â”€ Save

STEP 2: VERIFY IN CLOUD APPS
Location: Cloud Apps portal â†’ Settings â†’ 
         Microsoft Defender for Endpoint
â”œâ”€â”€ Connection status: Should show "Connected"
â”œâ”€â”€ Devices discovered: Count of MDE devices
â””â”€â”€ Data sync: Automatic

PREREQUISITES:
â”œâ”€â”€ Microsoft 365 E5 or equivalent licensing
â”œâ”€â”€ MDE P2 license
â”œâ”€â”€ Defender for Cloud Apps license
â”œâ”€â”€ Network Protection enabled on endpoints
â””â”€â”€ Devices onboarded to MDE

WHAT HAPPENS AFTER INTEGRATION:
â”œâ”€â”€ MDE sends cloud app traffic data to Cloud Apps
â”œâ”€â”€ Cloud Apps analyzes app usage patterns
â”œâ”€â”€ Shadow IT dashboard populates with discovered apps
â”œâ”€â”€ Risk scores calculated for each app
â””â”€â”€ Blocking policies can be enforced via MDE</code></pre>
                </div>
            </div>

            <h2>Shadow IT Discovery</h2>

            <div class="code-block">
                <div class="code-header">
                    <span class="code-lang">Cloud Discovery</span>
                    <button class="code-copy">ğŸ“‹ Copy</button>
                </div>
                <div class="code-content">
<pre><code>SHADOW IT DISCOVERY:
Location: Cloud Apps portal â†’ Cloud Discovery â†’ Dashboard

DATA SOURCE: MDE Endpoint Traffic
â”œâ”€â”€ Automatic - no log upload needed
â”œâ”€â”€ Real-time or near real-time data
â”œâ”€â”€ Per-device and per-user visibility
â””â”€â”€ Works for all MDE-onboarded devices

DISCOVERY DASHBOARD:
â”œâ”€â”€ Total apps discovered
â”œâ”€â”€ Risky apps count
â”œâ”€â”€ Data volume per app
â”œâ”€â”€ Users per app
â”œâ”€â”€ App categories breakdown
â””â”€â”€ Trend over time

APP CATALOG (35,000+ apps):
Each app scored on:
â”œâ”€â”€ General: Headquarters, founded, domain age
â”œâ”€â”€ Security: Encryption, MFA support, audit logs
â”œâ”€â”€ Compliance: SOC 2, HIPAA, GDPR, ISO 27001
â”œâ”€â”€ Legal: Data ownership, DMCA compliance
â””â”€â”€ Risk factors: Data breaches, vulnerabilities

RISK SCORE: 1-10
â”œâ”€â”€ 1-3: High risk
â”œâ”€â”€ 4-6: Medium risk
â”œâ”€â”€ 7-8: Low risk
â””â”€â”€ 9-10: Trusted/Sanctioned

EXAMPLE DISCOVERIES:
â”œâ”€â”€ Employees using personal cloud storage
â”œâ”€â”€ Unapproved collaboration tools
â”œâ”€â”€ Risky file-sharing services
â”œâ”€â”€ Consumer apps for business purposes
â””â”€â”€ Potential data exfiltration channels</code></pre>
                </div>
            </div>

            <h2>App Governance</h2>

            <div class="code-block">
                <div class="code-header">
                    <span class="code-lang">App Tagging and Policies</span>
                    <button class="code-copy">ğŸ“‹ Copy</button>
                </div>
                <div class="code-content">
<pre><code>APP TAGGING:
Location: Cloud Discovery â†’ Discovered apps â†’ Select app

TAG OPTIONS:
â”œâ”€â”€ Sanctioned: Approved for business use
â”œâ”€â”€ Unsanctioned: Not approved, should be blocked
â”œâ”€â”€ Monitored: Under review
â””â”€â”€ Custom tags: Create your own categories

GOVERNANCE ACTIONS:
For Unsanctioned Apps:
â”œâ”€â”€ Block access via MDE Network Protection
â”œâ”€â”€ User notification when blocked
â”œâ”€â”€ Track attempts to access blocked apps
â””â”€â”€ Generate alerts on policy violations

BLOCKING UNSANCTIONED APPS:
1. Tag app as "Unsanctioned" in Cloud Apps
2. MDE receives the app URL list
3. Network Protection blocks access on endpoints
4. User sees warning page when attempting access
5. Event logged in both Cloud Apps and MDE

POLICY CREATION:
Location: Cloud Apps â†’ Control â†’ Policies â†’ Create policy

EXAMPLE POLICY - Block risky file sharing:
â”œâ”€â”€ Type: App discovery policy
â”œâ”€â”€ Condition: Risk score < 5 AND Category = File sharing
â”œâ”€â”€ Governance: Tag as Unsanctioned
â”œâ”€â”€ Alert: Generate alert when triggered
â””â”€â”€ Threshold: > 5 users or > 100 MB data</code></pre>
                </div>
            </div>

            <h2>Unified Investigation</h2>

            <div class="code-block">
                <div class="code-header">
                    <span class="code-lang">Cross-Platform Investigation</span>
                    <button class="code-copy">ğŸ“‹ Copy</button>
                </div>
                <div class="code-content">
<pre><code>UNIFIED INVESTIGATION FLOW:

SCENARIO: User downloading data to cloud storage

1. MDE DETECTS:
   â”œâ”€â”€ Large file downloads from SharePoint
   â”œâ”€â”€ Connections to personal Dropbox
   â”œâ”€â”€ Unusual data volume
   â””â”€â”€ Triggers behavioral alert

2. CLOUD APPS SHOWS:
   â”œâ”€â”€ Files uploaded to Dropbox
   â”œâ”€â”€ User's cloud app activity history
   â”œâ”€â”€ App risk score (Dropbox = 8)
   â””â”€â”€ Other users with similar behavior

3. INVESTIGATION PATH:
   â”œâ”€â”€ MDE: Device timeline â†’ Network events
   â”œâ”€â”€ Cloud Apps: User â†’ Activity log
   â”œâ”€â”€ Correlate: Same time, same user, same files
   â””â”€â”€ Determine: Data exfiltration or legitimate

ADVANCED HUNTING (MDE):
<span class="comment">// Cloud app connections from endpoint</span>
DeviceNetworkEvents
| where Timestamp > ago(7d)
| where RemoteUrl has_any ("dropbox.com", "drive.google.com")
| summarize Connections = count(), 
            DataVolume = sum(ReceivedBytes + SentBytes)
  by DeviceName, AccountName, RemoteUrl

CLOUD APPS ACTIVITY:
â”œâ”€â”€ Activity log shows user actions
â”œâ”€â”€ Files accessed, downloaded, shared
â”œâ”€â”€ Governance actions applied
â””â”€â”€ Linked to MDE device context</code></pre>
                </div>
            </div>

            <h2>Session Controls</h2>

            <div class="code-block">
                <div class="code-header">
                    <span class="code-lang">Conditional Access App Control</span>
                    <button class="code-copy">ğŸ“‹ Copy</button>
                </div>
                <div class="code-content">
<pre><code>CONDITIONAL ACCESS APP CONTROL:
Provides real-time session monitoring and control

CAPABILITIES:
â”œâ”€â”€ Monitor user sessions in cloud apps
â”œâ”€â”€ Block downloads of sensitive files
â”œâ”€â”€ Protect on download (watermark, DRM)
â”œâ”€â”€ Block uploads to personal storage
â”œâ”€â”€ Block copy/paste of sensitive data
â””â”€â”€ Require step-up authentication

SETUP:
1. Configure app in Azure AD â†’ Enterprise Apps
2. Create Conditional Access policy:
   â”œâ”€â”€ Cloud apps: Select target app
   â”œâ”€â”€ Session: Use Conditional Access App Control
   â””â”€â”€ Enable policy
3. User accesses app â†’ Routed through Cloud Apps proxy
4. Session policies applied in real-time

EXAMPLE SESSION POLICY:
â”œâ”€â”€ Name: Block download of labeled files
â”œâ”€â”€ Source: Conditional Access App Control
â”œâ”€â”€ Activity type: Download file
â”œâ”€â”€ Files matching: Sensitivity label = Confidential
â”œâ”€â”€ Action: Block
â””â”€â”€ User notification: "This download is blocked per policy"

INTEGRATION WITH MDE:
â”œâ”€â”€ MDE provides device risk context
â”œâ”€â”€ High-risk devices get stricter session controls
â”œâ”€â”€ Low-risk devices get more permissive access
â””â”€â”€ Continuous risk assessment during session</code></pre>
                </div>
            </div>

            <h2>KQL - Cloud App Queries</h2>

            <div class="code-block">
                <div class="code-header">
                    <span class="code-lang">KQL - Cloud App Investigation</span>
                    <button class="code-copy">ğŸ“‹ Copy</button>
                </div>
                <div class="code-content">
<pre><code><span class="comment">// Top cloud apps by traffic volume</span>
<span class="variable">DeviceNetworkEvents</span>
<span class="operator">|</span> <span class="keyword">where</span> Timestamp <span class="operator">></span> <span class="function">ago</span>(<span class="number">7</span>d)
<span class="operator">|</span> <span class="keyword">extend</span> Domain = <span class="function">tostring</span>(<span class="function">parse_url</span>(RemoteUrl).Host)
<span class="operator">|</span> <span class="keyword">summarize</span> TotalBytes = <span class="function">sum</span>(SentBytes + ReceivedBytes),
          Connections = <span class="function">count</span>(),
          Users = <span class="function">dcount</span>(AccountName)
          <span class="keyword">by</span> Domain
<span class="operator">|</span> <span class="keyword">where</span> TotalBytes <span class="operator">></span> <span class="number">100000000</span> <span class="comment">// > 100 MB</span>
<span class="operator">|</span> <span class="keyword">order by</span> TotalBytes <span class="keyword">desc</span>

<span class="comment">// Users accessing risky cloud storage</span>
<span class="keyword">let</span> RiskyDomains = <span class="keyword">dynamic</span>([
    <span class="string">"mega.nz"</span>, <span class="string">"mediafire.com"</span>, <span class="string">"rapidshare.com"</span>
]);
<span class="variable">DeviceNetworkEvents</span>
<span class="operator">|</span> <span class="keyword">where</span> Timestamp <span class="operator">></span> <span class="function">ago</span>(<span class="number">7</span>d)
<span class="operator">|</span> <span class="keyword">where</span> RemoteUrl <span class="function">has_any</span> (RiskyDomains)
<span class="operator">|</span> <span class="keyword">summarize</span> Attempts = <span class="function">count</span>() <span class="keyword">by</span> AccountName, DeviceName, RemoteUrl

<span class="comment">// Blocked cloud app access attempts</span>
<span class="variable">DeviceEvents</span>
<span class="operator">|</span> <span class="keyword">where</span> Timestamp <span class="operator">></span> <span class="function">ago</span>(<span class="number">7</span>d)
<span class="operator">|</span> <span class="keyword">where</span> ActionType <span class="operator">==</span> <span class="string">"NetworkProtectionUserWarning"</span>
    <span class="operator">or</span> ActionType <span class="operator">==</span> <span class="string">"SmartScreenUrlWarning"</span>
<span class="operator">|</span> <span class="keyword">project</span> Timestamp, DeviceName, AccountName, 
         RemoteUrl, ActionType</code></pre>
                </div>
            </div>

            <div class="callout tip">
                <div class="callout-icon">ğŸ’¡</div>
                <div class="callout-content">
                    <h5>Best Practices</h5>
                    <ul>
                        <li><strong>Enable Network Protection</strong>: Required for blocking unsanctioned apps</li>
                        <li><strong>Review discovered apps regularly</strong>: New shadow IT appears constantly</li>
                        <li><strong>Start with monitoring</strong>: Understand usage before blocking</li>
                        <li><strong>Communicate with users</strong>: Explain why apps are blocked</li>
                        <li><strong>Provide alternatives</strong>: Offer sanctioned apps for common use cases</li>
                    </ul>
                </div>
            </div>

            <!-- Interview Tips -->
            <div class="interview-tips">
                <h3>ğŸ’¡ Key Interview Points</h3>
                <ul>
                    <li><strong>Shadow IT</strong>: Discover unsanctioned cloud apps via MDE traffic data</li>
                    <li><strong>App catalog</strong>: 35,000+ apps with risk scores</li>
                    <li><strong>Enforcement</strong>: Block unsanctioned apps via Network Protection</li>
                    <li><strong>Session controls</strong>: Real-time monitoring via Conditional Access App Control</li>
                    <li><strong>Integration benefit</strong>: Unified view of endpoint and cloud activity</li>
                </ul>
            </div>

            <nav class="page-nav">
                <a href="8-3-intune-integration.html" class="page-nav-link prev">
                    <span class="page-nav-label">â† Previous</span>
                    <span class="page-nav-title">Intune Integration</span>
                </a>
                <a href="8-5-api-overview.html" class="page-nav-link next">
                    <span class="page-nav-label">Next â†’</span>
                    <span class="page-nav-title">API Overview</span>
                </a>
            </nav>
        </div>
    </main>

    <div class="search-modal">
        <div class="search-modal-content">
            <div class="search-modal-input-wrapper">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="11" cy="11" r="8"></circle>
                    <path d="M21 21l-4.35-4.35"></path>
                </svg>
                <input type="text" class="search-modal-input" placeholder="Search pages..." autofocus>
                <button class="search-modal-close">ESC</button>
            </div>
            <div class="search-results"></div>
        </div>
    </div>
    <script src="main.js"></script>
</body>
</html>
