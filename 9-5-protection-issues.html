<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Protection Issues | MDE Ultimate Guide</title>
    <link rel="stylesheet" href="main.css">
</head>
<body>
    <header class="header">
        <div class="header-left">
            <button class="mobile-menu-btn" aria-label="Toggle menu">â˜°</button>
            <a href="index.html" class="logo">
                <div class="logo-icon">MDE</div>
                <div class="logo-text"><span>MDE</span> Ultimate Guide</div>
            </a>
        </div>
        <div class="search-container">
            <button class="search-btn">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="11" cy="11" r="8"></circle>
                    <path d="M21 21l-4.35-4.35"></path>
                </svg>
                <span>Search documentation...</span>
                <span class="search-shortcut"><kbd>âŒ˜</kbd><kbd>K</kbd></span>
            </button>
        </div>
        <div class="header-right">
            <a href="12-2-interview-questions.html" class="header-link">Interview Prep</a>
            <a href="5-3-kql-fundamentals.html" class="header-link">KQL Guide</a>
        </div>
    </header>

    <div class="sidebar-overlay"></div>
    <aside class="sidebar"></aside>

    <main class="main-content">
        <div class="content-wrapper">
            <div class="overview-box">
                <h4>ğŸ¯ What This Page Covers</h4>
                <p>Troubleshooting guide for MDE protection issues. Learn to diagnose and fix problems with real-time protection, cloud connectivity, definitions, and feature functionality.</p>
            </div>

            <h1>Protection Issues Troubleshooting</h1>

            <p>This guide covers common protection issues and their resolutions for Microsoft Defender for Endpoint.</p>

            <h2>Common Protection Issues</h2>

            <div class="flow-diagram">
                <div class="diagram-title">Protection Issue Categories</div>
<pre>
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    PROTECTION ISSUE CATEGORIES                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚  REAL-TIME PROTECTION           CLOUD PROTECTION                        â”‚
â”‚  â”œâ”€â”€ RTP disabled               â”œâ”€â”€ Cloud connectivity failed          â”‚
â”‚  â”œâ”€â”€ RTP won't enable           â”œâ”€â”€ Sample submission failing          â”‚
â”‚  â”œâ”€â”€ Files not being scanned    â”œâ”€â”€ Cloud verdict timeout              â”‚
â”‚  â””â”€â”€ High resource usage        â””â”€â”€ Block at first sight issues        â”‚
â”‚                                                                          â”‚
â”‚  DEFINITIONS                    FEATURES                                â”‚
â”‚  â”œâ”€â”€ Outdated definitions       â”œâ”€â”€ ASR rules not working              â”‚
â”‚  â”œâ”€â”€ Update failures            â”œâ”€â”€ Network Protection disabled        â”‚
â”‚  â”œâ”€â”€ Signature corruption       â”œâ”€â”€ Controlled Folder Access issues    â”‚
â”‚  â””â”€â”€ WSUS/SCCM update issues    â””â”€â”€ Tamper Protection conflicts        â”‚
â”‚                                                                          â”‚
â”‚  THIRD-PARTY CONFLICTS          EDR ISSUES                              â”‚
â”‚  â”œâ”€â”€ Another AV installed       â”œâ”€â”€ Sensor not reporting               â”‚
â”‚  â”œâ”€â”€ Passive mode issues        â”œâ”€â”€ Limited functionality              â”‚
â”‚  â”œâ”€â”€ Conflicting settings       â”œâ”€â”€ EDR block mode issues              â”‚
â”‚  â””â”€â”€ Driver conflicts           â””â”€â”€ Timeline missing data              â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</pre>
            </div>

            <h2>Real-Time Protection Issues</h2>

            <div class="code-block">
                <div class="code-header">
                    <span class="code-lang">RTP Troubleshooting</span>
                    <button class="code-copy">ğŸ“‹ Copy</button>
                </div>
                <div class="code-content">
<pre><code>REAL-TIME PROTECTION ISSUES:

ISSUE: RTP Disabled
SYMPTOMS:
â”œâ”€â”€ Windows Security shows RTP off
â”œâ”€â”€ Portal shows AV disabled
â””â”€â”€ No real-time scanning

DIAGNOSIS:
# Check RTP status
Get-MpComputerStatus | Select-Object RealTimeProtectionEnabled, 
    AntivirusEnabled, AMServiceEnabled

# Check for third-party AV
Get-CimInstance -Namespace root/SecurityCenter2 -ClassName AntivirusProduct

# Check if in passive mode
Get-MpComputerStatus | Select-Object AMRunningMode

SOLUTIONS:
# Enable RTP via PowerShell
Set-MpPreference -DisableRealtimeMonitoring $false

# If blocked by GPO, check:
# Computer Config â†’ Admin Templates â†’ Windows Components â†’ 
# Microsoft Defender Antivirus â†’ Real-time Protection

# If third-party AV, Defender may be in passive mode (expected)

ISSUE: RTP Won't Enable
CAUSES:
â”œâ”€â”€ Third-party AV installed (expected)
â”œâ”€â”€ GPO/Intune policy disabling
â”œâ”€â”€ Tamper Protection preventing change
â”œâ”€â”€ Service not running
â””â”€â”€ Corruption

SOLUTIONS:
# Check service status
Get-Service WinDefend | Select-Object Status, StartType

# Start service
Start-Service WinDefend

# Check for policy conflicts
gpresult /h gpreport.html
# Review Windows Defender settings

# Reset Defender (if corrupted)
# Requires running in Safe Mode or using DISM</code></pre>
                </div>
            </div>

            <h2>Cloud Protection Issues</h2>

            <div class="code-block">
                <div class="code-header">
                    <span class="code-lang">Cloud Connectivity Troubleshooting</span>
                    <button class="code-copy">ğŸ“‹ Copy</button>
                </div>
                <div class="code-content">
<pre><code>CLOUD PROTECTION ISSUES:

ISSUE: Cloud Connectivity Failed
SYMPTOMS:
â”œâ”€â”€ "Cloud-delivered protection is off" warning
â”œâ”€â”€ Block at First Sight not working
â”œâ”€â”€ Slow threat detection
â””â”€â”€ Sample submission failing

DIAGNOSIS:
# Test cloud connectivity
"%ProgramFiles%\Windows Defender\MpCmdRun.exe" -ValidateMapsConnection

# Check cloud settings
Get-MpPreference | Select-Object MAPSReporting, 
    CloudBlockLevel, CloudExtendedTimeout

# Test URL connectivity
Test-NetConnection -ComputerName "wdcp.microsoft.com" -Port 443
Test-NetConnection -ComputerName "wdcpalt.microsoft.com" -Port 443

REQUIRED URLS:
â”œâ”€â”€ *.wdcp.microsoft.com
â”œâ”€â”€ *.wdcpalt.microsoft.com
â”œâ”€â”€ *.wd.microsoft.com
â”œâ”€â”€ *.smartscreen.microsoft.com
â””â”€â”€ *.smartscreen-prod.microsoft.com

SOLUTIONS:
# Enable MAPS reporting
Set-MpPreference -MAPSReporting Advanced

# Set cloud block level
Set-MpPreference -CloudBlockLevel High

# Configure proxy if needed
Set-MpPreference -ProxyServer "http://proxy:8080"
Set-MpPreference -ProxyBypass "*.local"

# Firewall rules - ensure outbound HTTPS allowed

ISSUE: Sample Submission Failing
# Check sample sharing setting
Get-MpPreference | Select-Object SubmitSamplesConsent

# Enable sample sharing
Set-MpPreference -SubmitSamplesConsent SendAllSamples
# Options: 0=AlwaysPrompt, 1=SendSafeSamples, 2=NeverSend, 3=SendAllSamples</code></pre>
                </div>
            </div>

            <h2>Definition Update Issues</h2>

            <div class="code-block">
                <div class="code-header">
                    <span class="code-lang">Definition Troubleshooting</span>
                    <button class="code-copy">ğŸ“‹ Copy</button>
                </div>
                <div class="code-content">
<pre><code>DEFINITION UPDATE ISSUES:

ISSUE: Outdated Definitions
DIAGNOSIS:
# Check definition age
Get-MpComputerStatus | Select-Object AntivirusSignatureAge,
    AntivirusSignatureLastUpdated, AntivirusSignatureVersion

# Signature age should be < 1 day

MANUAL UPDATE:
# Force signature update
Update-MpSignature

# Or via command line
"%ProgramFiles%\Windows Defender\MpCmdRun.exe" -SignatureUpdate

ISSUE: Update Failures
COMMON CAUSES:
â”œâ”€â”€ No internet connectivity
â”œâ”€â”€ WSUS misconfiguration
â”œâ”€â”€ Proxy blocking updates
â”œâ”€â”€ Disk space issues
â””â”€â”€ Corrupted update cache

SOLUTIONS:
# Clear update cache and retry
"%ProgramFiles%\Windows Defender\MpCmdRun.exe" -RemoveDefinitions -All
Update-MpSignature

# Check Windows Update service
Get-Service wuauserv | Select-Object Status

# Direct download fallback
# Download from: https://www.microsoft.com/en-us/wdsi/definitions
# Run: mpam-fe.exe (full engine update)

WSUS/SCCM ISSUES:
â”œâ”€â”€ Verify WSUS has Defender definitions approved
â”œâ”€â”€ Check SCCM Endpoint Protection settings
â”œâ”€â”€ Force software update scan
â””â”€â”€ Review Windows Update logs

# Check update source configuration
Get-MpPreference | Select-Object SignatureFallbackOrder,
    SignatureDefinitionUpdateFileSharesSources</code></pre>
                </div>
            </div>

            <h2>Third-Party AV Conflicts</h2>

            <div class="code-block">
                <div class="code-header">
                    <span class="code-lang">Third-Party AV Troubleshooting</span>
                    <button class="code-copy">ğŸ“‹ Copy</button>
                </div>
                <div class="code-content">
<pre><code>THIRD-PARTY AV CONFLICTS:

EXPECTED BEHAVIOR:
â”œâ”€â”€ Third-party AV installed â†’ Defender in Passive Mode
â”œâ”€â”€ Passive Mode: No real-time protection, EDR still works
â”œâ”€â”€ After AV removal â†’ Defender should auto-enable
â””â”€â”€ EDR in Block Mode can provide additional protection

CHECK DEFENDER MODE:
Get-MpComputerStatus | Select-Object AMRunningMode
# Normal = Active, Passive = Another AV present

ISSUE: Defender Won't Activate After AV Removal
SOLUTIONS:
1. Restart the computer
2. Check for leftover AV services/drivers
3. Run: sc query | findstr -i "antivirus"
4. Check registry for third-party AV entries
5. Use vendor's removal tool

# Force Defender to re-evaluate
Set-MpPreference -DisableRealtimeMonitoring $false
Start-Service WinDefend

ISSUE: Want Both Running (EDR + Third-Party AV)
CONFIGURATION:
â”œâ”€â”€ MDE EDR works alongside third-party AV
â”œâ”€â”€ Enable "EDR in Block Mode" for extra protection
â”œâ”€â”€ Defender AV stays in Passive Mode
â””â”€â”€ Gives visibility without AV conflicts

ENABLE EDR IN BLOCK MODE:
# Via Intune or portal:
# Settings â†’ Endpoints â†’ Advanced features â†’ EDR in block mode: ON

# This allows:
â”œâ”€â”€ EDR behavioral detections still block threats
â”œâ”€â”€ No conflict with third-party AV
â”œâ”€â”€ Additional protection layer
â””â”€â”€ Full MDE visibility maintained</code></pre>
                </div>
            </div>

            <h2>Feature-Specific Issues</h2>

            <div class="code-block">
                <div class="code-header">
                    <span class="code-lang">Feature Troubleshooting</span>
                    <button class="code-copy">ğŸ“‹ Copy</button>
                </div>
                <div class="code-content">
<pre><code>FEATURE-SPECIFIC TROUBLESHOOTING:

ASR RULES NOT WORKING:
# Check ASR status
Get-MpPreference | Select-Object AttackSurfaceReductionRules_Ids,
    AttackSurfaceReductionRules_Actions

# Verify rules are in Block (1) not Audit (2)
# Check Windows version (some rules need newer versions)
# Review exclusions that might be too broad

NETWORK PROTECTION ISSUES:
# Check status
Get-MpPreference | Select-Object EnableNetworkProtection
# 0=Disabled, 1=Enabled, 2=AuditMode

# Enable
Set-MpPreference -EnableNetworkProtection Enabled

# Test connectivity
# Visit: https://smartscreentestratings2.net (should block)

CONTROLLED FOLDER ACCESS ISSUES:
# Check status
Get-MpPreference | Select-Object EnableControlledFolderAccess

# Check allowed apps
Get-MpPreference | Select-Object ControlledFolderAccessAllowedApplications

# Add allowed app
Add-MpPreference -ControlledFolderAccessAllowedApplications "C:\Program Files\App\app.exe"

TAMPER PROTECTION ISSUES:
# Check status
Get-MpComputerStatus | Select-Object IsTamperProtected

# If can't change settings locally:
â”œâ”€â”€ Tamper Protection is working as intended
â”œâ”€â”€ Manage via Intune or MDE portal
â”œâ”€â”€ Cannot disable locally (by design)
â””â”€â”€ Check Intune policies if changes needed</code></pre>
                </div>
            </div>

            <h2>Diagnostic Commands</h2>

            <div class="code-block">
                <div class="code-header">
                    <span class="code-lang">Comprehensive Diagnostics</span>
                    <button class="code-copy">ğŸ“‹ Copy</button>
                </div>
                <div class="code-content">
<pre><code><span class="comment"># Full Defender status check</span>
Get-MpComputerStatus | Format-List

<span class="comment"># Check all preferences</span>
Get-MpPreference | Format-List

<span class="comment"># Recent threat detections</span>
Get-MpThreat | Select-Object -Last 10

<span class="comment"># Check Defender event logs</span>
Get-WinEvent -LogName "Microsoft-Windows-Windows Defender/Operational" -MaxEvents 50 |
    Where-Object { $_.LevelDisplayName -eq "Error" -or $_.LevelDisplayName -eq "Warning" }

<span class="comment"># Run MDE Client Analyzer</span>
<span class="comment"># Download from Microsoft, extracts detailed diagnostics</span>
.\MDEClientAnalyzer.cmd

<span class="comment"># Collect support diagnostics</span>
"%ProgramFiles%\Windows Defender\MpCmdRun.exe" -GetFiles

<span class="comment"># Output location: C:\ProgramData\Microsoft\Windows Defender\Support</span></code></pre>
                </div>
            </div>

            <div class="callout warning">
                <div class="callout-icon">âš ï¸</div>
                <div class="callout-content">
                    <h5>Important Notes</h5>
                    <ul>
                        <li><strong>Tamper Protection</strong>: Prevents local changes to Defender settings</li>
                        <li><strong>Passive Mode</strong>: Expected when third-party AV is installed</li>
                        <li><strong>Policy precedence</strong>: Intune/GPO settings override local changes</li>
                        <li><strong>Support logs</strong>: Use MpCmdRun -GetFiles for support cases</li>
                    </ul>
                </div>
            </div>

            <!-- Interview Tips -->
            <div class="interview-tips">
                <h3>ğŸ’¡ Key Interview Points</h3>
                <ul>
                    <li><strong>Passive Mode</strong>: Defender state when third-party AV is installed</li>
                    <li><strong>Cloud connectivity</strong>: wdcp.microsoft.com required for cloud protection</li>
                    <li><strong>EDR in Block Mode</strong>: Additional protection with third-party AV</li>
                    <li><strong>Tamper Protection</strong>: Prevents unauthorized setting changes</li>
                    <li><strong>Diagnostics</strong>: Get-MpComputerStatus, MpCmdRun -GetFiles</li>
                </ul>
            </div>

            <nav class="page-nav">
                <a href="9-4-performance-issues.html" class="page-nav-link prev">
                    <span class="page-nav-label">â† Previous</span>
                    <span class="page-nav-title">Performance Issues</span>
                </a>
                <a href="9-6-client-analyzer.html" class="page-nav-link next">
                    <span class="page-nav-label">Next â†’</span>
                    <span class="page-nav-title">Client Analyzer</span>
                </a>
            </nav>
        </div>
    </main>

    <div class="search-modal">
        <div class="search-modal-content">
            <div class="search-modal-input-wrapper">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="11" cy="11" r="8"></circle>
                    <path d="M21 21l-4.35-4.35"></path>
                </svg>
                <input type="text" class="search-modal-input" placeholder="Search pages..." autofocus>
                <button class="search-modal-close">ESC</button>
            </div>
            <div class="search-results"></div>
        </div>
    </div>
    <script src="main.js"></script>
</body>
</html>
