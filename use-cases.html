<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Use Cases - MDE Ultimate Guide</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <nav class="navbar">
        <div class="navbar-container">
            <a href="index.html" class="navbar-brand"><span class="brand-icon">ğŸ›¡ï¸</span><span>MDE Ultimate Guide</span></a>
            <button class="navbar-toggle">â˜°</button>
            <ul class="navbar-nav">
                <li class="nav-item"><a href="index.html" class="nav-link">Home</a></li>
                <li class="nav-item"><a href="architecture.html" class="nav-link">Architecture</a></li>
                <li class="nav-item"><a href="deployment.html" class="nav-link">Deployment</a></li>
                <li class="nav-item"><a href="features.html" class="nav-link">Features</a></li>
                <li class="nav-item"><a href="asr-rules.html" class="nav-link">ASR Rules</a></li>
                <li class="nav-item"><a href="analyst-engineer.html" class="nav-link">Analyst vs Engineer</a></li>
                <li class="nav-item"><a href="troubleshooting.html" class="nav-link">Troubleshooting</a></li>
                <li class="nav-item"><a href="licensing.html" class="nav-link">Licensing & Comparison</a></li>
                <li class="nav-item"><a href="kql-rules.html" class="nav-link">KQL Rules</a></li>
                <li class="nav-item"><a href="use-cases.html" class="nav-link active">Use Cases</a></li>
                <li class="nav-item"><a href="automation.html" class="nav-link">Automation</a></li>
                <li class="nav-item"><a href="best-practices.html" class="nav-link">Best Practices</a></li>
            </ul>
        </div>
    </nav>

    <main class="main-container">
        <div class="content-wrapper">
            <aside class="sidebar">
                <nav class="sidebar-nav">
                    <div class="sidebar-title">On This Page</div>
                    <ul class="sidebar-links">
                        <li><a href="#overview">Overview</a></li>
                        <li><a href="#ransomware">Ransomware Detection</a></li>
                        <li><a href="#lateral-movement">Lateral Movement</a></li>
                        <li><a href="#credential-theft">Credential Theft</a></li>
                        <li><a href="#initial-access">Initial Access</a></li>
                        <li><a href="#persistence">Persistence Mechanisms</a></li>
                        <li><a href="#c2">Command & Control</a></li>
                    </ul>
                </nav>
            </aside>

            <div class="content">
                <h1>ğŸ¯ Detection Use Cases</h1>
                <p class="section-desc">Real-world attack scenarios and how to detect them with MDE, including KQL queries, response actions, and MITRE ATT&CK mapping.</p>

                <section id="overview">
                    <h2>Attack Lifecycle Overview</h2>
                    <div class="diagram-container">
                        <div class="diagram-title">Attack Kill Chain with MDE Detection Points</div>
                        <pre style="font-family: var(--font-mono); font-size: 0.7rem; line-height: 1.2; color: var(--text-secondary);">
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ATTACK LIFECYCLE & MDE DETECTION                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚   â”‚ INITIAL â”‚â”€â”€â–ºâ”‚EXECUTIONâ”‚â”€â”€â–ºâ”‚PERSIST- â”‚â”€â”€â–ºâ”‚PRIVILEGEâ”‚â”€â”€â–ºâ”‚ DEFENSE â”‚          â”‚
â”‚   â”‚ ACCESS  â”‚   â”‚         â”‚   â”‚  ENCE   â”‚   â”‚  ESCAL  â”‚   â”‚ EVASION â”‚          â”‚
â”‚   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜          â”‚
â”‚        â”‚             â”‚             â”‚             â”‚             â”‚                â”‚
â”‚   â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”          â”‚
â”‚   â”‚â€¢ Email  â”‚   â”‚â€¢ Scriptsâ”‚   â”‚â€¢ Run    â”‚   â”‚â€¢ UAC    â”‚   â”‚â€¢ Tamper â”‚          â”‚
â”‚   â”‚â€¢ Web    â”‚   â”‚â€¢ Macros â”‚   â”‚  Keys   â”‚   â”‚  Bypass â”‚   â”‚  AV     â”‚          â”‚
â”‚   â”‚â€¢ USB    â”‚   â”‚â€¢ LOLBinsâ”‚   â”‚â€¢ Tasks  â”‚   â”‚â€¢ Exploitâ”‚   â”‚â€¢ Logs   â”‚          â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚        â”‚             â”‚             â”‚             â”‚             â”‚                â”‚
â”‚   MDE: ASR      MDE: EDR      MDE: EDR      MDE: EDR      MDE: Tamper          â”‚
â”‚   SmartScreen   Behavioral    Custom Det    Behavioral    Protection           â”‚
â”‚                                                                                  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚   â”‚CREDENTIALâ”€â”€â–ºâ”‚DISCOVERYâ”‚â”€â”€â–ºâ”‚ LATERAL â”‚â”€â”€â–ºâ”‚COLLECTN â”‚â”€â”€â–ºâ”‚EXFIL/   â”‚          â”‚
â”‚   â”‚ ACCESS  â”‚   â”‚         â”‚   â”‚MOVEMENT â”‚   â”‚         â”‚   â”‚ IMPACT  â”‚          â”‚
â”‚   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜          â”‚
â”‚        â”‚             â”‚             â”‚             â”‚             â”‚                â”‚
â”‚   â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”          â”‚
â”‚   â”‚â€¢ LSASS  â”‚   â”‚â€¢ AD Enumâ”‚   â”‚â€¢ PsExec â”‚   â”‚â€¢ Archiveâ”‚   â”‚â€¢ Crypto â”‚          â”‚
â”‚   â”‚â€¢ SAM    â”‚   â”‚â€¢ Networkâ”‚   â”‚â€¢ WMI    â”‚   â”‚â€¢ Stage  â”‚   â”‚â€¢ Exfil  â”‚          â”‚
â”‚   â”‚â€¢ Kerberosâ”‚  â”‚â€¢ Shares â”‚   â”‚â€¢ RDP    â”‚   â”‚â€¢ Emails â”‚   â”‚â€¢ Destroyâ”‚          â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚        â”‚             â”‚             â”‚             â”‚             â”‚                â”‚
â”‚   MDE: LSASS    MDE: Custom   MDE: Built-in  MDE: DLP     MDE: Ransomware      â”‚
â”‚   Protection    Detection     Alerts        Integration   Protection           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        </pre>
                    </div>
                </section>

                <section id="ransomware">
                    <h2>ğŸ” Ransomware Detection</h2>
                    
                    <div class="card">
                        <div class="card-header">
                            <div class="card-icon">âš ï¸</div>
                            <div>
                                <h4 class="card-title">Ransomware Attack Scenario</h4>
                                <p class="card-subtitle">MITRE: T1486 (Data Encrypted for Impact)</p>
                            </div>
                        </div>
                        <div class="card-body">
                            <p><strong>Attack Flow:</strong> Phishing â†’ Macro execution â†’ Cobalt Strike beacon â†’ Credential theft â†’ Lateral movement â†’ Domain admin â†’ Deploy ransomware</p>
                        </div>
                    </div>

                    <h3>Detection: Mass File Encryption</h3>
                    <div class="code-block">
                        <div class="code-header"><span class="code-lang">KQL</span><button class="code-copy">Copy</button></div>
                        <pre><code>// Detect high-volume file modifications (encryption indicator)
DeviceFileEvents
| where Timestamp > ago(1h)
| where ActionType in ("FileModified", "FileRenamed")
| summarize FileCount = count(), 
            UniqueExtensions = dcount(FileName),
            FileList = make_set(FileName, 10)
    by DeviceName, InitiatingProcessFileName, bin(Timestamp, 5m)
| where FileCount > 100
| project Timestamp, DeviceName, InitiatingProcessFileName, 
          FileCount, UniqueExtensions, FileList</code></pre>
                    </div>

                    <h3>Detection: Shadow Copy Deletion</h3>
                    <div class="code-block">
                        <div class="code-header"><span class="code-lang">KQL</span><button class="code-copy">Copy</button></div>
                        <pre><code>// Ransomware pre-encryption: deleting backups
DeviceProcessEvents
| where Timestamp > ago(24h)
| where FileName in~ ("vssadmin.exe", "wmic.exe", "bcdedit.exe", "wbadmin.exe")
| where ProcessCommandLine has_any ("delete", "shadows", "shadowcopy", 
    "recoveryenabled", "catalog", "systemstatebackup")
| project Timestamp, DeviceName, AccountName, FileName, ProcessCommandLine
| extend ThreatType = "Ransomware Preparation"</code></pre>
                    </div>

                    <h3>Response Actions</h3>
                    <div class="alert alert-danger">
                        <div class="alert-icon">ğŸš¨</div>
                        <div class="alert-content">
                            <div class="alert-title">Immediate Response</div>
                            <ol>
                                <li><strong>Isolate device</strong> immediately from network</li>
                                <li><strong>Identify scope</strong> - which devices are affected</li>
                                <li><strong>Block indicators</strong> - hash, IP, domain</li>
                                <li><strong>Preserve evidence</strong> - collect investigation package</li>
                                <li><strong>Engage IR team</strong> - escalate to incident response</li>
                            </ol>
                        </div>
                    </div>
                </section>

                <section id="lateral-movement">
                    <h2>ğŸ”€ Lateral Movement Detection</h2>
                    
                    <div class="card">
                        <div class="card-header">
                            <div class="card-icon">ğŸ”€</div>
                            <div>
                                <h4 class="card-title">Lateral Movement Scenario</h4>
                                <p class="card-subtitle">MITRE: T1021 (Remote Services)</p>
                            </div>
                        </div>
                        <div class="card-body">
                            <p>Attackers move between systems using legitimate tools: PsExec, WMI, RDP, SMB, WinRM.</p>
                        </div>
                    </div>

                    <h3>Detection: PsExec Usage</h3>
                    <div class="code-block">
                        <div class="code-header"><span class="code-lang">KQL</span><button class="code-copy">Copy</button></div>
                        <pre><code>// Detect PsExec and similar tools
DeviceProcessEvents
| where Timestamp > ago(24h)
| where FileName in~ ("psexec.exe", "psexec64.exe", "paexec.exe", "remcom.exe")
    or ProcessCommandLine has_any ("\\\\", "-s cmd", "-accepteula")
| project Timestamp, DeviceName, AccountName, FileName, 
          ProcessCommandLine, InitiatingProcessFileName

// Detect PSEXESVC service on target
DeviceProcessEvents
| where FileName =~ "PSEXESVC.exe"
| project Timestamp, DeviceName, AccountName, ProcessCommandLine</code></pre>
                    </div>

                    <h3>Detection: WMI Remote Execution</h3>
                    <div class="code-block">
                        <div class="code-header"><span class="code-lang">KQL</span><button class="code-copy">Copy</button></div>
                        <pre><code>// WMI used for remote execution
DeviceProcessEvents
| where Timestamp > ago(24h)
| where InitiatingProcessFileName =~ "wmiprvse.exe"
| where FileName in~ ("cmd.exe", "powershell.exe", "pwsh.exe")
| project Timestamp, DeviceName, AccountName, FileName, ProcessCommandLine

// WMIC remote execution
DeviceProcessEvents
| where FileName =~ "wmic.exe"
| where ProcessCommandLine has "/node:" 
    and ProcessCommandLine has_any ("process", "call", "create")
| project Timestamp, DeviceName, AccountName, ProcessCommandLine</code></pre>
                    </div>

                    <h3>Detection: Unusual RDP Connections</h3>
                    <div class="code-block">
                        <div class="code-header"><span class="code-lang">KQL</span><button class="code-copy">Copy</button></div>
                        <pre><code>// RDP connections from unusual sources
DeviceLogonEvents
| where Timestamp > ago(7d)
| where LogonType == "RemoteInteractive"
| where ActionType == "LogonSuccess"
| summarize ConnectionCount = count(), 
            SourceIPs = make_set(RemoteIP)
    by DeviceName, AccountName
| where ConnectionCount > 5
| project DeviceName, AccountName, ConnectionCount, SourceIPs</code></pre>
                    </div>
                </section>

                <section id="credential-theft">
                    <h2>ğŸ”‘ Credential Theft Detection</h2>
                    
                    <div class="card">
                        <div class="card-header">
                            <div class="card-icon">ğŸ”‘</div>
                            <div>
                                <h4 class="card-title">Credential Access Scenario</h4>
                                <p class="card-subtitle">MITRE: T1003 (OS Credential Dumping)</p>
                            </div>
                        </div>
                        <div class="card-body">
                            <p>Attackers target LSASS, SAM database, and Kerberos tickets to steal credentials for privilege escalation and lateral movement.</p>
                        </div>
                    </div>

                    <h3>Detection: LSASS Access (Mimikatz)</h3>
                    <div class="code-block">
                        <div class="code-header"><span class="code-lang">KQL</span><button class="code-copy">Copy</button></div>
                        <pre><code>// Detect LSASS memory access
DeviceProcessEvents
| where Timestamp > ago(24h)
| where ProcessCommandLine has_any (
    "sekurlsa::logonpasswords",
    "sekurlsa::wdigest", 
    "lsadump::",
    "privilege::debug"
)
| project Timestamp, DeviceName, AccountName, FileName, ProcessCommandLine

// LSASS dump via comsvcs.dll
DeviceProcessEvents
| where ProcessCommandLine has "comsvcs.dll" 
    and ProcessCommandLine has_any ("MiniDump", "#24", "full")
| project Timestamp, DeviceName, AccountName, ProcessCommandLine

// Procdump targeting LSASS
DeviceProcessEvents
| where FileName =~ "procdump.exe" or FileName =~ "procdump64.exe"
| where ProcessCommandLine has_any ("lsass", "-ma", "-accepteula")
| project Timestamp, DeviceName, AccountName, ProcessCommandLine</code></pre>
                    </div>

                    <h3>Detection: SAM/SYSTEM Hive Access</h3>
                    <div class="code-block">
                        <div class="code-header"><span class="code-lang">KQL</span><button class="code-copy">Copy</button></div>
                        <pre><code>// Registry hive credential extraction
DeviceProcessEvents
| where Timestamp > ago(24h)
| where ProcessCommandLine has "reg" 
    and ProcessCommandLine has "save"
    and ProcessCommandLine has_any ("sam", "system", "security")
| project Timestamp, DeviceName, AccountName, ProcessCommandLine

// Shadow copy credential access
DeviceProcessEvents
| where ProcessCommandLine has_any (
    "\\\\?\\GLOBALROOT\\Device\\HarddiskVolumeShadowCopy",
    "vssadmin list shadows"
)
| where ProcessCommandLine has_any ("sam", "system", "ntds")
| project Timestamp, DeviceName, AccountName, ProcessCommandLine</code></pre>
                    </div>

                    <h3>Detection: DCSync Attack</h3>
                    <div class="code-block">
                        <div class="code-header"><span class="code-lang">KQL</span><button class="code-copy">Copy</button></div>
                        <pre><code>// DCSync indicators
DeviceProcessEvents
| where Timestamp > ago(24h)
| where ProcessCommandLine has_any (
    "lsadump::dcsync",
    "GetNCChanges",
    "/user:krbtgt",
    "secretsdump"
)
| project Timestamp, DeviceName, AccountName, ProcessCommandLine

// Correlate with network to DC
DeviceNetworkEvents
| where Timestamp > ago(24h)
| where RemotePort in (135, 389, 636, 445)
| where RemoteIP has "10."  // Adjust for your DC IPs
| summarize count() by DeviceName, RemoteIP, RemotePort</code></pre>
                    </div>
                </section>

                <section id="initial-access">
                    <h2>ğŸ“§ Initial Access Detection</h2>
                    
                    <h3>Detection: Macro-Based Attack</h3>
                    <div class="code-block">
                        <div class="code-header"><span class="code-lang">KQL</span><button class="code-copy">Copy</button></div>
                        <pre><code>// Office spawning suspicious processes
DeviceProcessEvents
| where Timestamp > ago(24h)
| where InitiatingProcessFileName in~ (
    "winword.exe", "excel.exe", "powerpnt.exe", "outlook.exe"
)
| where FileName in~ (
    "powershell.exe", "cmd.exe", "wscript.exe", "cscript.exe",
    "mshta.exe", "regsvr32.exe", "rundll32.exe", "certutil.exe"
)
| project Timestamp, DeviceName, AccountName, 
          InitiatingProcessFileName, FileName, ProcessCommandLine</code></pre>
                    </div>

                    <h3>Detection: ISO/IMG Mount Execution</h3>
                    <div class="code-block">
                        <div class="code-header"><span class="code-lang">KQL</span><button class="code-copy">Copy</button></div>
                        <pre><code>// Files executed from mounted disk images (MOTW bypass)
DeviceProcessEvents
| where Timestamp > ago(24h)
| where FolderPath matches regex @"^[D-Z]:\\"
| where InitiatingProcessFileName in~ ("explorer.exe", "cmd.exe")
| where FileName endswith ".exe" or FileName endswith ".dll"
| project Timestamp, DeviceName, AccountName, FolderPath, FileName</code></pre>
                    </div>
                </section>

                <section id="persistence">
                    <h2>ğŸ”„ Persistence Detection</h2>
                    
                    <h3>Detection: Registry Run Keys</h3>
                    <div class="code-block">
                        <div class="code-header"><span class="code-lang">KQL</span><button class="code-copy">Copy</button></div>
                        <pre><code>// New Registry Run key persistence
DeviceRegistryEvents
| where Timestamp > ago(24h)
| where ActionType == "RegistryValueSet"
| where RegistryKey has_any (
    "\\CurrentVersion\\Run",
    "\\CurrentVersion\\RunOnce",
    "\\CurrentVersion\\RunServices"
)
| project Timestamp, DeviceName, AccountName, 
          RegistryKey, RegistryValueName, RegistryValueData</code></pre>
                    </div>

                    <h3>Detection: Scheduled Task Creation</h3>
                    <div class="code-block">
                        <div class="code-header"><span class="code-lang">KQL</span><button class="code-copy">Copy</button></div>
                        <pre><code>// Suspicious scheduled task creation
DeviceProcessEvents
| where Timestamp > ago(24h)
| where FileName =~ "schtasks.exe"
| where ProcessCommandLine has "/create"
| where ProcessCommandLine has_any (
    "powershell", "cmd", "wscript", "mshta", "regsvr32",
    "http://", "https://", "bypass", "-enc"
)
| project Timestamp, DeviceName, AccountName, ProcessCommandLine</code></pre>
                    </div>
                </section>

                <section id="c2">
                    <h2>ğŸ“¡ Command & Control Detection</h2>
                    
                    <h3>Detection: Beacon-Like Traffic</h3>
                    <div class="code-block">
                        <div class="code-header"><span class="code-lang">KQL</span><button class="code-copy">Copy</button></div>
                        <pre><code>// Regular interval connections (beaconing)
DeviceNetworkEvents
| where Timestamp > ago(24h)
| where RemotePort in (80, 443, 8080, 8443)
| summarize ConnectionCount = count(), 
            TimeDiffs = make_list(Timestamp)
    by DeviceName, RemoteIP, RemoteUrl, bin(Timestamp, 1h)
| where ConnectionCount > 20
| project DeviceName, RemoteIP, RemoteUrl, ConnectionCount

// Connections to recently registered domains
DeviceNetworkEvents
| where Timestamp > ago(24h)
| where isnotempty(RemoteUrl)
| where RemoteUrl !has_any ("microsoft.com", "windows.com", "office.com")
| summarize count() by DeviceName, RemoteUrl
| where count_ > 10</code></pre>
                    </div>

                    <h3>Detection: DNS Exfiltration</h3>
                    <div class="code-block">
                        <div class="code-header"><span class="code-lang">KQL</span><button class="code-copy">Copy</button></div>
                        <pre><code>// Long subdomain DNS queries (data exfil)
DeviceNetworkEvents
| where Timestamp > ago(24h)
| where ActionType == "DnsQueryResponse"
| extend SubdomainLength = strlen(split(RemoteUrl, ".")[0])
| where SubdomainLength > 40
| project Timestamp, DeviceName, RemoteUrl, SubdomainLength</code></pre>
                    </div>
                </section>

                <div class="flex-between mt-4">
                    <a href="kql-rules.html" class="btn btn-secondary">â† KQL Rules</a>
                    <a href="automation.html" class="btn btn-primary">Automation â†’</a>
                </div>
            </div>
        </div>
    </main>

    <footer class="footer">
        <div class="footer-content">
            <p class="footer-text">MDE Ultimate Guide | For Security Analysts & Engineers</p>
        </div>
    </footer>
    <script src="js/main.js"></script>
</body>
</html>
